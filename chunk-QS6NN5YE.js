import{a as Te}from"./chunk-Y2D5TXOC.js";import"./chunk-FK6H3RFT.js";import{b as Ve,c as Fe,d as Ne,l as ie}from"./chunk-CTNMEYGD.js";import{a as ne,b as Q}from"./chunk-VKLMJP2F.js";import"./chunk-BYXBJQAS.js";import{$a as D,A as Ee,Ba as N,Cb as X,Db as pe,Fa as Oe,Ha as A,N as F,Ob as Re,R as W,Sa as u,Ta as g,Tb as q,Ua as we,Wa as H,X as f,Xa as B,Y as _,Ya as T,Z as J,Za as d,_ as ae,_a as l,ab as s,bb as c,c as ke,cb as C,db as x,eb as Y,fb as S,ga as b,gb as O,hb as p,ib as Z,j as L,jb as ee,kb as te,lb as G,mb as K,n as Ie,nb as R,ob as a,pb as y,qb as E,rb as re,sa as me,sb as se,ta as r,tb as ce,ub as le,w as U,xa as I}from"./chunk-IDEEAVYW.js";import{a as P,b as M,f as v}from"./chunk-EQDQRRRY.js";var Be=["metamapContainer"];function Xe(i,t){i&1&&(s(0,"div",3),C(1,"div",6),s(2,"p"),a(3,"Cargando verificaci\xF3n..."),c()())}function $e(i,t){i&1&&C(0,"div",4,0)}function We(i,t){i&1&&a(0," \u2705 ")}function Ye(i,t){i&1&&a(0," \u23F3 ")}function Ge(i,t){i&1&&a(0," \u274C ")}function Qe(i,t){i&1&&a(0," \u2753 ")}function Je(i,t){i&1&&a(0," Verificaci\xF3n completada exitosamente ")}function Ze(i,t){i&1&&a(0," Verificaci\xF3n en proceso ")}function et(i,t){i&1&&a(0," Verificaci\xF3n rechazada - Intente nuevamente ")}function tt(i,t){i&1&&a(0," Estado desconocido ")}function nt(i,t){if(i&1&&(s(0,"div",7)(1,"div",8),u(2,We,1,0)(3,Ye,1,0)(4,Ge,1,0)(5,Qe,1,0),c(),s(6,"div",9),u(7,Je,1,0)(8,Ze,1,0)(9,et,1,0)(10,tt,1,0),c()()),i&2){let e,n,o=p();R("status-"+o.verificationStatus()),r(2),g((e=o.verificationStatus())==="completed"?2:e==="pending"?3:e==="rejected"?4:5),r(5),g((n=o.verificationStatus())==="completed"?7:n==="pending"?8:n==="rejected"?9:10)}}var ue=class i{clientId="689833b7d4e7dd0ca48216fb";flowId="689833b7d4e7dd00d08216fa";metadata='{"key": "value"}';metamapContainer;isLoading=b(!0);verificationStatus=b(null);onVerificationComplete=pe();onVerificationStart=pe();onVerificationError=pe();ngOnInit(){this.initializeMetamap()}ngOnDestroy(){this.cleanupMetamap()}initializeMetamap(){typeof window<"u"&&window.metamap?this.setupMetamapButton():setTimeout(()=>{window.metamap?this.setupMetamapButton():(console.error("Metamap SDK failed to load"),this.isLoading.set(!1))},1e3)}setupMetamapButton(){try{let t=document.createElement("metamap-button");this.clientId&&t.setAttribute("clientid",this.clientId),t.setAttribute("flowid",this.flowId),this.metadata&&t.setAttribute("metadata",this.metadata),t.addEventListener("verification-start",e=>{console.log("Metamap verification started:",e.detail),this.onVerificationStart.emit({clientId:this.clientId}),this.verificationStatus.set("pending")}),t.addEventListener("verification-complete",e=>{console.log("Metamap verification completed:",e.detail),this.verificationStatus.set("completed"),this.onVerificationComplete.emit({clientId:this.clientId,status:"completed",data:e.detail})}),t.addEventListener("verification-error",e=>{console.error("Metamap verification error:",e.detail),this.verificationStatus.set("rejected"),this.onVerificationError.emit({clientId:this.clientId,error:e.detail})}),this.metamapContainer?.nativeElement&&(this.metamapContainer.nativeElement.appendChild(t),this.isLoading.set(!1))}catch(t){console.error("Error setting up Metamap button:",t),this.isLoading.set(!1)}}cleanupMetamap(){this.metamapContainer?.nativeElement&&(this.metamapContainer.nativeElement.innerHTML="")}startVerification(){let t=this.metamapContainer?.nativeElement.querySelector("metamap-button");t&&t.click()}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=N({type:i,selectors:[["app-metamap"]],viewQuery:function(e,n){if(e&1&&Z(Be,7),e&2){let o;ee(o=te())&&(n.metamapContainer=o.first)}},inputs:{clientId:"clientId",flowId:"flowId",metadata:"metadata"},outputs:{onVerificationComplete:"onVerificationComplete",onVerificationStart:"onVerificationStart",onVerificationError:"onVerificationError"},decls:9,vars:2,consts:[["metamapContainer",""],[1,"metamap-container"],[1,"metamap-header"],[1,"loading-state"],[1,"metamap-button-container"],[1,"verification-status",3,"class"],[1,"spinner"],[1,"verification-status"],[1,"status-icon"],[1,"status-message"]],template:function(e,n){e&1&&(s(0,"div",1)(1,"div",2)(2,"h3"),a(3,"Verificaci\xF3n de Identidad"),c(),s(4,"p"),a(5,"Complete su verificaci\xF3n biom\xE9trica con Metamap"),c()(),u(6,Xe,4,0,"div",3)(7,$e,2,0,"div",4),u(8,nt,11,4,"div",5),c()),e&2&&(r(6),g(n.isLoading()?6:7),r(2),g(n.verificationStatus()?8:-1))},dependencies:[q],styles:[".metamap-container[_ngcontent-%COMP%]{background:#1f2937;border-radius:12px;padding:24px;margin:16px 0;border:1px solid #374151}.metamap-header[_ngcontent-%COMP%]{text-align:center;margin-bottom:24px}.metamap-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#f9fafb;font-size:1.5rem;font-weight:600;margin:0 0 8px}.metamap-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#9ca3af;font-size:.875rem;margin:0}.loading-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:32px 16px}.loading-state[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{width:32px;height:32px;border:3px solid #374151;border-top:3px solid #06b6d4;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:16px}.loading-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#9ca3af;font-size:.875rem;margin:0}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.metamap-button-container[_ngcontent-%COMP%]{display:flex;justify-content:center;margin:24px 0}.metamap-button-container[_ngcontent-%COMP%]   metamap-button[_ngcontent-%COMP%]{display:block;width:100%;max-width:300px}.verification-status[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:16px;border-radius:8px;margin-top:20px}.verification-status.status-completed[_ngcontent-%COMP%]{background-color:#10b9811a;border:1px solid #10b981}.verification-status.status-completed[_ngcontent-%COMP%]   .status-icon[_ngcontent-%COMP%]{color:#10b981}.verification-status.status-completed[_ngcontent-%COMP%]   .status-message[_ngcontent-%COMP%]{color:#d1fae5}.verification-status.status-pending[_ngcontent-%COMP%]{background-color:#f59e0b1a;border:1px solid #f59e0b}.verification-status.status-pending[_ngcontent-%COMP%]   .status-icon[_ngcontent-%COMP%]{color:#f59e0b}.verification-status.status-pending[_ngcontent-%COMP%]   .status-message[_ngcontent-%COMP%]{color:#fef3c7}.verification-status.status-rejected[_ngcontent-%COMP%]{background-color:#ef44441a;border:1px solid #ef4444}.verification-status.status-rejected[_ngcontent-%COMP%]   .status-icon[_ngcontent-%COMP%]{color:#ef4444}.verification-status.status-rejected[_ngcontent-%COMP%]   .status-message[_ngcontent-%COMP%]{color:#fee2e2}.status-icon[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:700}.status-message[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500}@media (max-width: 768px){.metamap-container[_ngcontent-%COMP%]{margin:12px 0;padding:20px}.metamap-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.25rem}.verification-status[_ngcontent-%COMP%]{flex-direction:column;text-align:center;gap:8px}}"]})};var V={production:!1,mifiel:{apiUrl:"https://sandbox.mifiel.com/api/v1/",apiKey:"YOUR_SANDBOX_API_KEY_HERE",appId:"YOUR_SANDBOX_APP_ID_HERE",secret:"YOUR_SANDBOX_SECRET_HERE",widgetUrl:"https://widget-sandbox.mifiel.com/js/dist/mifiel.js"},conekta:{apiUrl:"https://api.conekta.io",publicKey:"key_YOUR_SANDBOX_PUBLIC_KEY_HERE",privateKey:"key_YOUR_SANDBOX_PRIVATE_KEY_HERE"},apiUrl:"http://localhost:3000/api",odoo:{apiKey:"DEV_ODOO_API_KEY_HERE",baseUrl:"https://conductores-del-mundo-sapi-de-cv.odoo.com",database:"conductores-test",version:"1.0"},make:{baseUrl:"https://hook.eu2.make.com",apiKey:"DEV_MAKE_API_KEY_PLACEHOLDER",webhooks:{newClient:"/YOUR_WEBHOOK_ID_1",documentUpload:"/YOUR_WEBHOOK_ID_2",paymentConfirmation:"/YOUR_WEBHOOK_ID_3",signatureComplete:"/YOUR_WEBHOOK_ID_4",dashboardSync:"/YOUR_WEBHOOK_ID_5",tandaUpdate:"/YOUR_WEBHOOK_ID_6",analyticsReport:"/YOUR_WEBHOOK_ID_7",scoringComplete:"/YOUR_WEBHOOK_ID_8"}},version:"1.0.0"};var ge=class i{constructor(t){this.http=t}apiUrl=V.mifiel.apiUrl;apiKey=V.mifiel.apiKey;getHeaders(){return new ne({Authorization:`Token token=${this.apiKey}`,"Content-Type":"application/json"})}createDocument(t){return this.http.post(`${this.apiUrl}documents`,t,{headers:this.getHeaders()})}getDocument(t){return this.http.get(`${this.apiUrl}documents/${t}`,{headers:this.getHeaders()})}getDocuments(){return this.http.get(`${this.apiUrl}documents`,{headers:this.getHeaders()})}downloadDocument(t){return this.http.get(`${this.apiUrl}documents/${t}/download`,{headers:this.getHeaders(),responseType:"blob"})}loadSigningWidget(){return v(this,null,function*(){return new Promise((t,e)=>{if(window.Mifiel){t(window.Mifiel);return}let n=document.createElement("script");n.src=V.mifiel.widgetUrl,n.onload=()=>t(window.Mifiel),n.onerror=e,document.head.appendChild(n)})})}initializeSigningWidget(t,e,n,o){return v(this,null,function*(){let m=yield this.loadSigningWidget();new m.Widget({widgetId:e,containerId:t,successCallback:n,errorCallback:o,sandbox:!V.production}).render()})}static \u0275fac=function(e){return new(e||i)(W(Q))};static \u0275prov=F({token:i,factory:i.\u0275fac,providedIn:"root"})};var oe=class i{toastId=0;toasts=b([]);getToasts(){return this.toasts.asReadonly()}success(t){this.addToast(t,"success")}info(t){this.addToast(t,"info")}error(t){this.addToast(t,"error")}addToast(t,e){let n={id:++this.toastId,message:t,type:e};this.toasts.update(o=>[...o,n]),setTimeout(()=>{this.removeToast(n.id)},5e3)}removeToast(t){this.toasts.update(e=>e.filter(n=>n.id!==t))}static \u0275fac=function(e){return new(e||i)};static \u0275prov=F({token:i,factory:i.\u0275fac,providedIn:"root"})};var z=class i{constructor(t){this.http=t}baseUrl=V.make.baseUrl;getHeaders(){return new ne({"Content-Type":"application/json","X-PWA-Version":V.version,"X-Source":"conductores-pwa",Authorization:`Bearer ${V.make.apiKey}`})}crearOportunidadEnOdoo(t){let e={scenario:"pwa_to_odoo_opportunity",data:M(P({},t),{asesorId:"current_user",fechaCreacion:new Date().toISOString()}),timestamp:new Date().toISOString(),source:"pwa_cotizador"};return this.http.post(`${this.baseUrl}/webhooks/cotizador-oportunidad`,e,{headers:this.getHeaders()})}subirDocumentoAOdoo(t,e){let n={scenario:"pwa_to_odoo_document",data:{expedienteId:t,clientId:e.clientId,documento:{nombre:e.nombre,tipo:e.tipo,fileName:e.fileName,fileData:e.archivo,uploadDate:new Date().toISOString()}},timestamp:new Date().toISOString(),source:"pwa_document_capture"};return this.http.post(`${this.baseUrl}/webhooks/documento-upload`,n,{headers:this.getHeaders()})}notificarPagoConfirmado(t){let e={scenario:"conekta_to_odoo_payment",data:M(P({},t),{fechaPago:new Date().toISOString(),moneda:"MXN"}),timestamp:new Date().toISOString(),source:"pwa_conekta_webhook"};return this.http.post(`${this.baseUrl}/webhooks/pago-confirmado`,e,{headers:this.getHeaders()})}notificarFirmaCompletada(t){let e={scenario:"mifiel_to_odoo_signature",data:M(P({},t),{fechaFirma:new Date().toISOString(),estadoContrato:"firmado"}),timestamp:new Date().toISOString(),source:"pwa_mifiel_webhook"};return this.http.post(`${this.baseUrl}/webhooks/firma-completada`,e,{headers:this.getHeaders()})}obtenerDashboardDeOdoo(){return this.http.get(`${this.baseUrl}/webhooks/dashboard-data`,{headers:this.getHeaders()})}crearTandaEnOdoo(t){let e={scenario:"pwa_to_odoo_tanda",data:M(P({},t),{fechaCreacion:new Date().toISOString(),estado:"activa",cicloActual:1}),timestamp:new Date().toISOString(),source:"pwa_tandas"};return this.http.post(`${this.baseUrl}/webhooks/tanda-crear`,e,{headers:this.getHeaders()})}avanzarCicloTandaEnOdoo(t,e){let n={scenario:"odoo_tanda_advance_cycle",data:M(P({tandaId:t},e),{fechaAvance:new Date().toISOString()}),timestamp:new Date().toISOString(),source:"pwa_tandas"};return this.http.post(`${this.baseUrl}/webhooks/tanda-ciclo`,n,{headers:this.getHeaders()})}sendScoringComplete(t){let e={scenario:"odoo_kinban_scoring",data:M(P({},t),{timestamp:t.timestamp.toISOString()}),timestamp:new Date().toISOString(),source:"pwa_kinban"};return this.http.post(`${this.baseUrl}${V.make.webhooks.scoringComplete||"/scoring-complete"}`,e,{headers:this.getHeaders()})}notificarEventoEspecial(t){let e={scenario:"odoo_special_event",data:M(P({},t),{fechaEvento:new Date().toISOString()}),timestamp:new Date().toISOString(),source:"pwa_eventos"};return this.http.post(`${this.baseUrl}/webhooks/evento-especial`,e,{headers:this.getHeaders()})}sincronizarClientesDeOdoo(){return this.http.get(`${this.baseUrl}/webhooks/sync-clientes`,{headers:this.getHeaders()})}verificarEscenariosMake(){return this.http.get(`${this.baseUrl}/webhooks/health`,{headers:this.getHeaders()})}guardarCotizacionEnOdoo(t){let e={scenario:"save_quotation_odoo",data:t,timestamp:new Date().toISOString(),source:"pwa_cotizador"};return this.http.post(`${this.baseUrl}/webhooks/guardar-cotizacion`,e,{headers:this.getHeaders()})}enviarAnalyticsAOdoo(t){let e={scenario:"pwa_analytics_to_odoo",data:M(P({},t),{timestamp:new Date().toISOString(),sessionId:sessionStorage.getItem("pwa_session_id")}),timestamp:new Date().toISOString(),source:"pwa_analytics"};return this.http.post(`${this.baseUrl}/webhooks/analytics`,e,{headers:this.getHeaders()})}sendDocumentUpload(t){let e={scenario:"document_upload_notification",data:M(P({},t),{timestamp:t.timestamp.toISOString()}),timestamp:new Date().toISOString(),source:"pwa_documents"};return this.http.post(`${this.baseUrl}/webhooks/document-upload`,e,{headers:this.getHeaders()})}sendSignatureComplete(t){let e={scenario:"signature_completed_notification",data:M(P({},t),{timestamp:t.timestamp.toISOString()}),timestamp:new Date().toISOString(),source:"pwa_signatures"};return this.http.post(`${this.baseUrl}/webhooks/signature-complete`,e,{headers:this.getHeaders()})}sendPaymentConfirmation(t){let e={scenario:"payment_confirmation_notification",data:M(P({},t),{timestamp:t.timestamp.toISOString()}),timestamp:new Date().toISOString(),source:"pwa_payments"};return this.http.post(`${this.baseUrl}/webhooks/payment-confirmation`,e,{headers:this.getHeaders()})}static \u0275fac=function(e){return new(e||i)(W(Q))};static \u0275prov=F({token:i,factory:i.\u0275fac,providedIn:"root"})};var ot=(i,t)=>t.id;function at(i,t){i&1&&(D(0,"i",19),a(1," Creando documento... "))}function rt(i,t){i&1&&(D(0,"i",20),a(1," Crear Documento para Firma "))}function st(i,t){if(i&1){let e=x();d(0,"div",4)(1,"h4",7),a(2,"Crear Documento para Firma"),l(),d(3,"div",8)(4,"div")(5,"label",9),a(6,"Nombre del Documento"),l(),d(7,"input",10),le("ngModelChange",function(o){f(e);let m=p();return ce(m.documentName,o)||(m.documentName=o),_(o)}),l()(),d(8,"div")(9,"label",9),a(10,"Archivo PDF"),l(),d(11,"input",11),S("change",function(o){f(e);let m=p();return _(m.onFileSelected(o))}),l()()(),d(12,"div",12)(13,"h5",13),a(14,"Datos del Firmante"),l(),d(15,"div",14)(16,"input",15),le("ngModelChange",function(o){f(e);let m=p();return ce(m.signerName,o)||(m.signerName=o),_(o)}),l(),d(17,"input",16),le("ngModelChange",function(o){f(e);let m=p();return ce(m.signerEmail,o)||(m.signerEmail=o),_(o)}),l(),d(18,"input",17),le("ngModelChange",function(o){f(e);let m=p();return ce(m.signerRFC,o)||(m.signerRFC=o),_(o)}),l()()(),d(19,"button",18),S("click",function(){f(e);let o=p();return _(o.createDocument())}),u(20,at,2,0)(21,rt,2,0),l()()}if(i&2){let e=p();r(7),se("ngModel",e.documentName),r(9),se("ngModel",e.signerName),r(),se("ngModel",e.signerEmail),r(),se("ngModel",e.signerRFC),r(),T("disabled",e.isCreating()),r(),g(e.isCreating()?20:21)}}function ct(i,t){if(i&1){let e=x();d(0,"div",5)(1,"h4",7),a(2),l(),D(3,"div",21),d(4,"div",22)(5,"button",23),S("click",function(){f(e);let o=p();return _(o.mode.set("create"))}),a(6," Volver "),l(),d(7,"button",24),S("click",function(){f(e);let o=p();return _(o.refreshDocumentStatus())}),D(8,"i",25),a(9," Actualizar Estado "),l()()()}if(i&2){let e,n=p();r(2),E(" Firmar: ",(e=n.currentDocument())==null?null:e.name," ")}}function lt(i,t){if(i&1){let e=x();d(0,"button",35),S("click",function(){f(e);let o=p().$implicit,m=p(2);return _(m.signDocument(o))}),a(1," Firmar "),l()}}function dt(i,t){if(i&1){let e=x();d(0,"button",36),S("click",function(){f(e);let o=p().$implicit,m=p(2);return _(m.downloadDocument(o.id))}),a(1," Descargar "),l()}}function mt(i,t){if(i&1&&(d(0,"div",27)(1,"div",28),D(2,"i",29),d(3,"div")(4,"p",30),a(5),l(),d(6,"p",31),a(7),l()()(),d(8,"div",32),u(9,lt,2,0,"button",33),u(10,dt,2,0,"button",34),l()()),i&2){let e=t.$implicit,n=p(2);r(2),R(n.getDocumentIcon(e.status)),r(3),y(e.name),r(2),re(" ",n.formatDate(e.created_at)," \u2022 ",n.getDocumentStatusText(e.status)," "),r(2),g(e.status==="pending"?9:-1),r(),g(e.status==="completed"&&e.download_url?10:-1)}}function pt(i,t){if(i&1&&(d(0,"div",6)(1,"h4",7),a(2,"Documentos Recientes"),l(),d(3,"div",26),H(4,mt,11,7,"div",27,ot),l()()),i&2){let e=p();r(4),B(e.documents())}}var _e=class i{constructor(t,e,n,o){this.mifielService=t;this.pdfService=e;this.toastService=n;this.makeIntegration=o;this.loadDocuments()}clientId;documentSigned=new A;mode=b("create");currentDocument=b(null);documents=b([]);isCreating=b(!1);documentName="";selectedFile=null;signerName="";signerEmail="";signerRFC="";onFileSelected(t){return v(this,null,function*(){let e=t.target.files?.[0];e&&e.type==="application/pdf"?this.selectedFile=e:this.toastService.error("Por favor selecciona un archivo PDF v\xE1lido")})}createDocument(){return v(this,null,function*(){if(!this.selectedFile||!this.documentName||!this.signerName||!this.signerEmail||!this.signerRFC){this.toastService.error("Por favor completa todos los campos");return}this.isCreating.set(!0);try{let t=yield this.fileToBase64(this.selectedFile),e={name:this.documentName,content:t,signers:[{name:this.signerName,email:this.signerEmail,tax_id:this.signerRFC}]},n=yield this.mifielService.createDocument(e).toPromise();n&&(this.currentDocument.set(n),this.documents.update(o=>[n,...o]),this.toastService.success("Documento creado exitosamente"),this.resetForm(),this.mode.set("sign"),setTimeout(()=>{this.initializeWidget(n)},100))}catch(t){console.error("Error creating document:",t),this.toastService.error("Error al crear el documento")}finally{this.isCreating.set(!1)}})}signDocument(t){return v(this,null,function*(){this.currentDocument.set(t),this.mode.set("sign"),setTimeout(()=>{this.initializeWidget(t)},100)})}initializeWidget(t){return v(this,null,function*(){if(t.signers.length>0){let e=t.signers[0];if(e.widget_id)try{yield this.mifielService.initializeSigningWidget("mifiel-widget-container",e.widget_id,n=>{this.toastService.success("Documento firmado exitosamente"),this.makeIntegration.sendSignatureComplete({clientId:this.clientId||"",documentId:t.id,documentName:t.name||"Contrato firmado",signerName:t.signers[0]?.name||"Cliente",signerEmail:t.signers[0]?.email||"",timestamp:new Date}).pipe(U(o=>(console.warn("Make.com webhook failed (non-critical):",o),L(null)))).subscribe(),this.refreshDocumentStatus(),this.documentSigned.emit(t)},n=>{console.error("Error signing document:",n),this.toastService.error("Error al firmar el documento")})}catch(n){console.error("Error initializing widget:",n),this.toastService.error("Error al inicializar el widget de firma")}}})}refreshDocumentStatus(){return v(this,null,function*(){let t=this.currentDocument();if(t)try{let e=yield this.mifielService.getDocument(t.id).toPromise();e&&(this.currentDocument.set(e),this.documents.update(n=>n.map(o=>o.id===e.id?e:o)))}catch(e){console.error("Error refreshing document:",e)}})}downloadDocument(t){return v(this,null,function*(){try{let e=yield this.mifielService.downloadDocument(t).toPromise();if(e){let n=window.URL.createObjectURL(e),o=document.createElement("a");o.href=n,o.download=`documento_firmado_${t}.pdf`,o.click(),window.URL.revokeObjectURL(n)}}catch(e){console.error("Error downloading document:",e),this.toastService.error("Error al descargar el documento")}})}loadDocuments(){return v(this,null,function*(){try{let t=yield this.mifielService.getDocuments().toPromise();t?.documents&&this.documents.set(t.documents)}catch(t){console.error("Error loading documents:",t)}})}fileToBase64(t){return v(this,null,function*(){return new Promise((e,n)=>{let o=new FileReader;o.readAsDataURL(t),o.onload=()=>{let h=o.result.split(",")[1];e(h)},o.onerror=n})})}resetForm(){this.documentName="",this.selectedFile=null,this.signerName="",this.signerEmail="",this.signerRFC=""}getStatusClasses(){return"flex items-center gap-2 px-3 py-1 rounded-full text-sm bg-blue-600 text-white"}getStatusIcon(){return"fas fa-file-signature"}getStatusText(){return"Sistema de Firma Digital"}getDocumentIcon(t){return{pending:"fas fa-clock text-amber-400",signed:"fas fa-signature text-blue-400",completed:"fas fa-check-circle text-green-400"}[t]||"fas fa-file text-gray-400"}getDocumentStatusText(t){return{pending:"Pendiente de firma",signed:"Firmado",completed:"Completado"}[t]||t}formatDate(t){return new Date(t).toLocaleDateString("es-MX")}static \u0275fac=function(e){return new(e||i)(I(ge),I(Te),I(oe),I(z))};static \u0275cmp=N({type:i,selectors:[["app-digital-signature"]],inputs:{clientId:"clientId"},outputs:{documentSigned:"documentSigned"},decls:12,vars:8,consts:[[1,"digital-signature-container"],[1,"signature-header"],[1,"text-lg","font-semibold","text-white","mb-4"],[1,"flex","items-center","gap-2","mb-4"],[1,"create-form","bg-gray-700","p-4","rounded-lg","mb-4"],[1,"signing-widget","bg-gray-700","p-4","rounded-lg","mb-4"],[1,"documents-list"],[1,"text-md","font-medium","text-white","mb-3"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4","mb-4"],[1,"block","text-sm","text-gray-300","mb-2"],["type","text","placeholder","Contrato de Venta a Plazo - Juan P\xE9rez",1,"w-full","px-3","py-2","bg-gray-600","text-white","rounded-lg",3,"ngModelChange","ngModel"],["type","file","accept",".pdf",1,"w-full","px-3","py-2","bg-gray-600","text-white","rounded-lg",3,"change"],[1,"signer-info","bg-gray-600","p-3","rounded-lg","mb-4"],[1,"text-sm","font-medium","text-white","mb-3"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-3"],["type","text","placeholder","Nombre Completo",1,"px-3","py-2","bg-gray-500","text-white","rounded",3,"ngModelChange","ngModel"],["type","email","placeholder","correo@ejemplo.com",1,"px-3","py-2","bg-gray-500","text-white","rounded",3,"ngModelChange","ngModel"],["type","text","placeholder","RFC (12-13 caracteres)",1,"px-3","py-2","bg-gray-500","text-white","rounded",3,"ngModelChange","ngModel"],[1,"w-full","bg-primary-cyan-600","hover:bg-primary-cyan-700","text-white","py-3","px-4","rounded-lg","font-medium","disabled:opacity-50",3,"click","disabled"],[1,"fas","fa-spinner","fa-spin","mr-2"],[1,"fas","fa-file-signature","mr-2"],["id","mifiel-widget-container",1,"min-h-96","bg-white","rounded-lg"],[1,"mt-4","flex","gap-2"],[1,"px-4","py-2","bg-gray-600","text-white","rounded-lg",3,"click"],[1,"px-4","py-2","bg-blue-600","text-white","rounded-lg",3,"click"],[1,"fas","fa-refresh","mr-2"],[1,"space-y-2"],[1,"document-item","bg-gray-700","p-3","rounded-lg","flex","items-center","justify-between"],[1,"flex","items-center"],[1,"mr-3"],[1,"text-white","font-medium"],[1,"text-sm","text-gray-400"],[1,"flex","gap-2"],[1,"px-3","py-1","bg-amber-600","text-white","text-sm","rounded"],[1,"px-3","py-1","bg-green-600","text-white","text-sm","rounded"],[1,"px-3","py-1","bg-amber-600","text-white","text-sm","rounded",3,"click"],[1,"px-3","py-1","bg-green-600","text-white","text-sm","rounded",3,"click"]],template:function(e,n){e&1&&(d(0,"div",0)(1,"div",1)(2,"h3",2),a(3,"Firma Digital"),l(),d(4,"div",3)(5,"div"),D(6,"i"),d(7,"span"),a(8),l()()()(),u(9,st,22,6,"div",4),u(10,ct,10,1,"div",5),u(11,pt,6,0,"div",6),l()),e&2&&(r(5),R(n.getStatusClasses()),r(),R(n.getStatusIcon()),r(2),y(n.getStatusText()),r(),g(n.mode()==="create"?9:-1),r(),g(n.mode()==="sign"&&n.currentDocument()?10:-1),r(),g(n.documents().length>0?11:-1))},dependencies:[q,ie,Ve,Fe,Ne],encapsulation:2})};var he=class i{constructor(t){this.http=t}apiUrl=V.conekta.apiUrl;privateKey=V.conekta.privateKey;getHeaders(){let t=btoa(`${this.privateKey}:`);return new ne({Authorization:`Basic ${t}`,"Content-Type":"application/json",Accept:"application/vnd.conekta-v2.1.0+json"})}createOXXOPayment(t){let e=Math.floor(Date.now()/1e3)+604800,n={amount:Math.round(t.amount*100),currency:"MXN",description:t.description,customer_info:t.customerInfo,line_items:t.lineItems.map(o=>M(P({},o),{unit_price:Math.round(o.unit_price*100)})),payment_method:{type:"oxxo_cash",expires_at:e}};return this.http.post(`${this.apiUrl}/orders`,n,{headers:this.getHeaders()})}createSPEIPayment(t){let e=Math.floor(Date.now()/1e3)+86400,n={amount:Math.round(t.amount*100),currency:"MXN",description:t.description,customer_info:t.customerInfo,line_items:t.lineItems.map(o=>M(P({},o),{unit_price:Math.round(o.unit_price*100)})),payment_method:{type:"spei",expires_at:e}};return this.http.post(`${this.apiUrl}/orders`,n,{headers:this.getHeaders()})}createPaymentLink(t){let e=Math.floor(Date.now()/1e3)+604800,n={amount:Math.round(t.amount*100),currency:"MXN",description:t.description,customer_info:t.customerInfo,line_items:t.lineItems.map(o=>M(P({},o),{unit_price:Math.round(o.unit_price*100)})),expires_at:e,allowed_payment_methods:["cash","spei","card"]};return this.http.post(`${this.apiUrl}/checkout`,n,{headers:this.getHeaders()})}getOrder(t){return this.http.get(`${this.apiUrl}/orders/${t}`,{headers:this.getHeaders()})}getPaymentLink(t){return this.http.get(`${this.apiUrl}/checkout/${t}`,{headers:this.getHeaders()})}extractOXXOInfo(t){let e=t.charges?.data?.[0];return e?.payment_method?.type==="oxxo_cash"?{reference:e.payment_method.reference||"",expires_at:e.payment_method.expires_at||0,barcode_url:e.payment_method.barcode_url,instructions:`Acude a cualquier OXXO y proporciona la referencia: ${e.payment_method.reference}`}:null}extractSPEIInfo(t){let e=t.charges?.data?.[0];return e?.payment_method?.type==="spei"?{clabe:e.payment_method.clabe||"",bank:e.payment_method.bank||"STP",reference:e.id,expires_at:e.payment_method.expires_at||0}:null}isPaymentCompleted(t){return t.payment_status==="paid"}formatAmount(t){return new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(t/100)}formatExpirationDate(t){return new Date(t*1e3).toLocaleDateString("es-MX",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}generateMockPaymentRequest(t,e){return{clientId:t,amount:e,description:`Enganche - Vagoneta H6C - Cliente ${t}`,customerInfo:{name:"Juan P\xE9rez Gonz\xE1lez",email:"juan.perez@example.com",phone:"+525512345678"},lineItems:[{name:"Enganche Vagoneta H6C",unit_price:e,quantity:1,description:"Pago de enganche para adquisici\xF3n de vagoneta H6C"}],method:"oxxo"}}static \u0275fac=function(e){return new(e||i)(W(Q))};static \u0275prov=F({token:i,factory:i.\u0275fac,providedIn:"root"})};function gt(i,t){i&1&&(s(0,"div",23),C(1,"i",24),a(2," Generando instrucciones de pago... "),c())}function ft(i,t){if(i&1){let e=x();s(0,"div",8)(1,"h4",11),a(2,"Selecciona el m\xE9todo de pago:"),c(),s(3,"div",12)(4,"button",13),O("click",function(){f(e);let o=p();return _(o.selectPaymentMethod("oxxo"))}),s(5,"div",14)(6,"div",15),a(7," \u{1F3EA} "),c(),s(8,"div",16)(9,"h5",17),a(10,"OXXO"),c(),s(11,"p",18),a(12,"Paga en efectivo"),c(),s(13,"p",19),a(14,"Disponible 7 d\xEDas"),c()()()(),s(15,"button",13),O("click",function(){f(e);let o=p();return _(o.selectPaymentMethod("spei"))}),s(16,"div",14)(17,"div",20),a(18," \u{1F3E6} "),c(),s(19,"div",16)(20,"h5",17),a(21,"SPEI"),c(),s(22,"p",18),a(23,"Transferencia bancaria"),c(),s(24,"p",19),a(25,"Disponible 24 hrs"),c()()()(),s(26,"button",21),O("click",function(){f(e);let o=p();return _(o.selectPaymentMethod("link"))}),s(27,"div",14)(28,"div",22),a(29," \u{1F517} "),c(),s(30,"div",16)(31,"h5",17),a(32,"Link de Pago"),c(),s(33,"p",18),a(34,"Tarjeta, OXXO o SPEI en un solo link"),c(),s(35,"p",19),a(36,"La opci\xF3n m\xE1s flexible"),c()()()()(),u(37,gt,3,0,"div",23),c()}if(i&2){let e=p();r(4),Y("disabled",e.isProcessing()),r(11),Y("disabled",e.isProcessing()),r(11),Y("disabled",e.isProcessing()),r(11),g(e.isProcessing()?37:-1)}}function _t(i,t){if(i&1){let e=x();s(0,"div",25)(1,"div",32)(2,"h4",33)(3,"span",34),a(4,"\u{1F3EA}"),c(),a(5," Pago en OXXO "),c(),s(6,"div",35),C(7,"i",36),a(8," Pendiente de Pago "),c()(),s(9,"div",37)(10,"div",38)(11,"p",39),a(12,"Referencia OXXO"),c(),s(13,"div",40)(14,"span",41),a(15),c(),s(16,"button",42),O("click",function(){let o;f(e);let m=p(2);return _(m.copyToClipboard(((o=m.currentPayment())==null||o.oxxoInfo==null?null:o.oxxoInfo.reference)||""))}),C(17,"i",43),c()()(),s(18,"div",44)(19,"p",18),C(20,"i",36),a(21),c()()(),s(22,"div",45)(23,"h5",46),a(24,"Instrucciones:"),c(),s(25,"ol",47)(26,"li"),a(27,"Acude a cualquier tienda OXXO"),c(),s(28,"li"),a(29,"Proporciona la referencia al cajero"),c(),s(30,"li"),a(31,"Realiza el pago por "),s(32,"strong"),a(33),c()(),s(34,"li"),a(35,"Guarda tu comprobante de pago"),c()()()()}if(i&2){let e,n,o=p(2);r(15),y((e=o.currentPayment())==null||e.oxxoInfo==null?null:e.oxxoInfo.reference),r(6),E(" V\xE1lido hasta: ",o.formatExpirationDate(((n=o.currentPayment())==null||n.oxxoInfo==null?null:n.oxxoInfo.expires_at)||0)," "),r(12),y(o.formatCurrency(o.paymentAmount))}}function ht(i,t){if(i&1){let e=x();s(0,"div",26)(1,"div",32)(2,"h4",33)(3,"span",48),a(4,"\u{1F3E6}"),c(),a(5," Transferencia SPEI "),c(),s(6,"div",35),C(7,"i",36),a(8," Pendiente de Pago "),c()(),s(9,"div",37)(10,"div",49)(11,"div",50)(12,"label",18),a(13,"CLABE"),c(),s(14,"div",40)(15,"span",51),a(16),c(),s(17,"button",42),O("click",function(){let o;f(e);let m=p(2);return _(m.copyToClipboard(((o=m.currentPayment())==null||o.speiInfo==null?null:o.speiInfo.clabe)||""))}),C(18,"i",43),c()()(),s(19,"div",50)(20,"label",18),a(21,"Banco"),c(),s(22,"span",52),a(23),c()(),s(24,"div",50)(25,"label",18),a(26,"Referencia"),c(),s(27,"span",53),a(28),c()()(),s(29,"div",44)(30,"p",18),C(31,"i",36),a(32),c()()(),s(33,"div",45)(34,"h5",46),a(35,"Instrucciones:"),c(),s(36,"ol",47)(37,"li"),a(38,"Usa la CLABE para hacer la transferencia"),c(),s(39,"li"),a(40,"Monto exacto: "),s(41,"strong"),a(42),c()(),s(43,"li"),a(44,"Incluye la referencia en el concepto"),c(),s(45,"li"),a(46,"El pago se refleja en segundos"),c()()()()}if(i&2){let e,n,o,m,h=p(2);r(16),y((e=h.currentPayment())==null||e.speiInfo==null?null:e.speiInfo.clabe),r(7),y((n=h.currentPayment())==null||n.speiInfo==null?null:n.speiInfo.bank),r(5),y((o=h.currentPayment())==null||o.speiInfo==null?null:o.speiInfo.reference),r(4),E(" V\xE1lido hasta: ",h.formatExpirationDate(((m=h.currentPayment())==null||m.speiInfo==null?null:m.speiInfo.expires_at)||0)," "),r(10),y(h.formatCurrency(h.paymentAmount))}}function Ct(i,t){if(i&1){let e=x();s(0,"div",27)(1,"div",32)(2,"h4",33)(3,"span",54),a(4,"\u{1F517}"),c(),a(5," Link de Pago "),c(),s(6,"div",35),C(7,"i",36),a(8," Pendiente de Pago "),c()(),s(9,"div",55)(10,"div",56)(11,"p",57),a(12,"Comparte este link con el cliente:"),c(),s(13,"div",58),C(14,"input",59),s(15,"button",42),O("click",function(){let o;f(e);let m=p(2);return _(m.copyToClipboard(((o=m.currentPayment())==null||o.linkInfo==null?null:o.linkInfo.url)||""))}),C(16,"i",43),c(),s(17,"button",60),O("click",function(){f(e);let o=p(2);return _(o.openPaymentLink())}),C(18,"i",61),c()()(),s(19,"div",44)(20,"p",18),C(21,"i",36),a(22),c()()(),s(23,"div",45)(24,"h5",46),a(25,"El cliente puede pagar con:"),c(),s(26,"ul",62)(27,"li"),C(28,"i",63),a(29,"Tarjeta de d\xE9bito o cr\xE9dito"),c(),s(30,"li"),C(31,"i",64),a(32,"OXXO (en efectivo)"),c(),s(33,"li"),C(34,"i",65),a(35,"SPEI (transferencia)"),c()()()()}if(i&2){let e,n,o=p(2);r(14),Y("value",((e=o.currentPayment())==null||e.linkInfo==null?null:e.linkInfo.url)||""),r(8),E(" V\xE1lido hasta: ",o.formatExpirationDate(((n=o.currentPayment())==null||n.linkInfo==null?null:n.linkInfo.expires_at)||0)," ")}}function xt(i,t){i&1&&(C(0,"i",24),a(1," Verificando... "))}function bt(i,t){i&1&&(C(0,"i",66),a(1," Verificar Estado "))}function vt(i,t){if(i&1){let e=x();s(0,"div",9),u(1,_t,36,3,"div",25),u(2,ht,47,5,"div",26),u(3,Ct,36,2,"div",27),s(4,"div",28)(5,"button",29),O("click",function(){f(e);let o=p();return _(o.refreshPaymentStatus())}),u(6,xt,2,0)(7,bt,2,0),c(),s(8,"button",30),O("click",function(){f(e);let o=p();return _(o.mode.set("select"))}),C(9,"i",31),a(10," Cambiar M\xE9todo "),c()()()}if(i&2){let e,n,o,m=p();r(),g(((e=m.currentPayment())==null?null:e.method)==="oxxo"&&((e=m.currentPayment())!=null&&e.oxxoInfo)?1:-1),r(),g(((n=m.currentPayment())==null?null:n.method)==="spei"&&((n=m.currentPayment())!=null&&n.speiInfo)?2:-1),r(),g(((o=m.currentPayment())==null?null:o.method)==="link"&&((o=m.currentPayment())!=null&&o.linkInfo)?3:-1),r(2),Y("disabled",m.isRefreshing()),r(),g(m.isRefreshing()?6:7)}}function yt(i,t){if(i&1){let e=x();s(0,"div",10)(1,"div",67),C(2,"i",68),c(),s(3,"h4",69),a(4,"\xA1Pago Confirmado!"),c(),s(5,"p",70),a(6,"El pago ha sido procesado exitosamente"),c(),s(7,"div",71)(8,"button",72),O("click",function(){f(e);let o=p();return _(o.proceedToContract())}),C(9,"i",73),a(10," Continuar con Firma Digital "),c()()()}}var Ce=class i{constructor(t,e,n){this.conektaService=t;this.toastService=e;this.makeIntegration=n}clientId;paymentAmount=0;paymentDescription="Pago de enganche";paymentCompleted=new A;proceedToSignature=new A;mode=b("select");currentPayment=b(null);isProcessing=b(!1);isRefreshing=b(!1);selectPaymentMethod(t){return v(this,null,function*(){if(!this.isProcessing()){this.isProcessing.set(!0);try{let e=this.buildPaymentRequest(t),n;switch(t){case"oxxo":let o=yield this.conektaService.createOXXOPayment(e).toPromise();if(o)n={orderId:o.id,method:"oxxo",amount:this.paymentAmount,status:"pending",oxxoInfo:this.conektaService.extractOXXOInfo(o)||void 0,createdAt:new Date,expiresAt:o.charges?.data?.[0]?.payment_method?.expires_at?new Date(o.charges.data[0].payment_method.expires_at*1e3):void 0};else throw new Error("No se pudo crear la orden OXXO");break;case"spei":let m=yield this.conektaService.createSPEIPayment(e).toPromise();if(m)n={orderId:m.id,method:"spei",amount:this.paymentAmount,status:"pending",speiInfo:this.conektaService.extractSPEIInfo(m)||void 0,createdAt:new Date,expiresAt:m.charges?.data?.[0]?.payment_method?.expires_at?new Date(m.charges.data[0].payment_method.expires_at*1e3):void 0};else throw new Error("No se pudo crear la orden SPEI");break;case"link":let h=yield this.conektaService.createPaymentLink(e).toPromise();if(h)n={orderId:h.id,method:"link",amount:this.paymentAmount,status:"pending",linkInfo:h,createdAt:new Date,expiresAt:new Date(h.expires_at*1e3)};else throw new Error("No se pudo crear el link de pago");break;default:throw new Error("M\xE9todo de pago no soportado")}this.currentPayment.set(n),this.mode.set("payment"),this.toastService.success("Instrucciones de pago generadas")}catch(e){console.error("Error creating payment:",e),this.toastService.error("Error al generar las instrucciones de pago")}finally{this.isProcessing.set(!1)}}})}refreshPaymentStatus(){return v(this,null,function*(){let t=this.currentPayment();if(!(!t?.orderId||this.isRefreshing())){this.isRefreshing.set(!0);try{if(t.method==="link"){if((yield this.conektaService.getPaymentLink(t.orderId).toPromise())?.status==="paid"){let n=M(P({},t),{status:"completed"});this.currentPayment.set(n),this.mode.set("completed"),this.makeIntegration.sendPaymentConfirmation({clientId:this.clientId,method:t.method,amount:t.amount,paymentId:t.orderId,currency:"MXN",status:"confirmed",timestamp:new Date}).pipe(U(o=>(console.warn("Make.com webhook failed (non-critical):",o),L(null)))).subscribe(),this.paymentCompleted.emit(n),this.toastService.success("\xA1Pago confirmado!")}}else{let e=yield this.conektaService.getOrder(t.orderId).toPromise();if(e&&this.conektaService.isPaymentCompleted(e)){let n=M(P({},t),{status:"completed"});this.currentPayment.set(n),this.mode.set("completed"),this.makeIntegration.sendPaymentConfirmation({clientId:this.clientId,method:t.method,amount:t.amount,paymentId:t.orderId,currency:"MXN",status:"confirmed",timestamp:new Date}).pipe(U(o=>(console.warn("Make.com webhook failed (non-critical):",o),L(null)))).subscribe(),this.paymentCompleted.emit(n),this.toastService.success("\xA1Pago confirmado!")}}}catch(e){console.error("Error checking payment status:",e),this.toastService.error("Error al verificar el estado del pago")}finally{this.isRefreshing.set(!1)}}})}copyToClipboard(t){navigator.clipboard.writeText(t).then(()=>{this.toastService.success("Copiado al portapapeles")}).catch(()=>{this.toastService.error("Error al copiar")})}openPaymentLink(){let t=this.currentPayment();t?.linkInfo?.url&&window.open(t.linkInfo.url,"_blank")}proceedToContract(){this.proceedToSignature.emit()}formatCurrency(t){return new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(t)}formatExpirationDate(t){return new Date(t*1e3).toLocaleDateString("es-MX",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}buildPaymentRequest(t){return{clientId:this.clientId,amount:this.paymentAmount,description:this.paymentDescription,customerInfo:{name:"Cliente Conductor",email:"cliente@example.com",phone:"+525512345678"},lineItems:[{name:this.paymentDescription,unit_price:this.paymentAmount,quantity:1,description:`Pago para cliente ${this.clientId}`}],method:t}}static \u0275fac=function(e){return new(e||i)(I(he),I(oe),I(z))};static \u0275cmp=N({type:i,selectors:[["app-payment-request"]],inputs:{clientId:"clientId",paymentAmount:"paymentAmount",paymentDescription:"paymentDescription"},outputs:{paymentCompleted:"paymentCompleted",proceedToSignature:"proceedToSignature"},decls:15,vars:5,consts:[[1,"payment-request-container"],[1,"payment-header"],[1,"text-lg","font-semibold","text-white","mb-4"],[1,"payment-amount","bg-primary-cyan-900","border","border-primary-cyan-700","rounded-lg","p-4","mb-6"],[1,"text-center"],[1,"text-sm","text-primary-cyan-300","mb-1"],[1,"text-3xl","font-bold","text-white"],[1,"text-sm","text-gray-400","mt-1"],[1,"payment-methods"],[1,"payment-instructions"],[1,"payment-completed"],[1,"text-md","font-medium","text-white","mb-4"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4","mb-6"],[1,"payment-method-card",3,"click","disabled"],[1,"flex","items-center","p-4"],[1,"payment-icon","bg-red-500"],[1,"ml-4","text-left"],[1,"font-semibold","text-white"],[1,"text-sm","text-gray-400"],[1,"text-xs","text-gray-500"],[1,"payment-icon","bg-blue-500"],[1,"payment-method-card","md:col-span-2",3,"click","disabled"],[1,"payment-icon","bg-green-500"],[1,"processing-indicator"],[1,"fas","fa-spinner","fa-spin","mr-2"],[1,"payment-info","oxxo-info"],[1,"payment-info","spei-info"],[1,"payment-info","link-info"],[1,"payment-actions"],[1,"refresh-button",3,"click","disabled"],[1,"back-button",3,"click"],[1,"fas","fa-arrow-left","mr-2"],[1,"payment-info-header"],[1,"text-lg","font-semibold","text-white","flex","items-center"],[1,"payment-icon","bg-red-500","mr-3"],[1,"payment-status","status-pending"],[1,"fas","fa-clock","mr-2"],[1,"reference-section"],[1,"reference-card"],[1,"text-sm","text-gray-400","mb-2"],[1,"reference-display"],[1,"reference-number"],[1,"copy-button",3,"click"],[1,"fas","fa-copy"],[1,"expiration-info"],[1,"instructions-box"],[1,"font-semibold","text-white","mb-3"],[1,"instruction-list"],[1,"payment-icon","bg-blue-500","mr-3"],[1,"spei-details"],[1,"spei-field"],[1,"clabe-number"],[1,"bank-name"],[1,"reference-text"],[1,"payment-icon","bg-green-500","mr-3"],[1,"link-section"],[1,"link-card"],[1,"text-sm","text-gray-400","mb-3"],[1,"link-display"],["type","text","readonly","",1,"link-input",3,"value"],[1,"open-link-button",3,"click"],[1,"fas","fa-external-link-alt"],[1,"payment-options"],[1,"fas","fa-credit-card","mr-2"],[1,"fas","fa-store","mr-2"],[1,"fas","fa-university","mr-2"],[1,"fas","fa-refresh","mr-2"],[1,"success-animation"],[1,"fas","fa-check-circle","text-green-400","text-6xl","mb-4"],[1,"text-xl","font-bold","text-white","mb-2"],[1,"text-gray-300","mb-4"],[1,"completed-actions"],[1,"proceed-button",3,"click"],[1,"fas","fa-file-signature","mr-2"]],template:function(e,n){e&1&&(s(0,"div",0)(1,"div",1)(2,"h3",2),a(3,"\u{1F4B3} Solicitar Pago de Enganche"),c(),s(4,"div",3)(5,"div",4)(6,"p",5),a(7,"Monto a Cobrar"),c(),s(8,"p",6),a(9),c(),s(10,"p",7),a(11),c()()()(),u(12,ft,38,4,"div",8),u(13,vt,11,5,"div",9),u(14,yt,11,0,"div",10),c()),e&2&&(r(9),y(n.formatCurrency(n.paymentAmount)),r(2),y(n.paymentDescription),r(),g(n.mode()==="select"?12:-1),r(),g(n.mode()==="payment"&&n.currentPayment()?13:-1),r(),g(n.mode()==="completed"?14:-1))},dependencies:[q,ie],styles:[".payment-request-container[_ngcontent-%COMP%]{max-width:600px}.payment-method-card[_ngcontent-%COMP%]{@apply bg-gray-700 hover:bg-gray-600 border border-gray-600 hover:border-primary-cyan-500 rounded-lg transition-all duration-200 cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed;}.payment-icon[_ngcontent-%COMP%]{@apply w-12 h-12 rounded-lg flex items-center justify-center text-2xl text-white;}.processing-indicator[_ngcontent-%COMP%]{@apply flex items-center justify-center text-primary-cyan-400 bg-primary-cyan-900 border border-primary-cyan-700 rounded-lg p-4;}.payment-info[_ngcontent-%COMP%]{@apply bg-gray-700 rounded-lg p-6 mb-6;}.payment-info-header[_ngcontent-%COMP%]{@apply flex items-center justify-between mb-6 pb-4 border-b border-gray-600;}.payment-status.status-pending[_ngcontent-%COMP%]{@apply flex items-center px-3 py-1 rounded-full text-sm bg-amber-600 text-white;}.reference-section[_ngcontent-%COMP%]{@apply mb-6;}.reference-card[_ngcontent-%COMP%], .spei-details[_ngcontent-%COMP%]{@apply bg-gray-800 rounded-lg p-4 mb-4;}.reference-display[_ngcontent-%COMP%], .link-display[_ngcontent-%COMP%]{@apply flex items-center gap-2;}.reference-number[_ngcontent-%COMP%], .clabe-number[_ngcontent-%COMP%]{@apply font-mono text-xl font-bold text-white bg-gray-900 px-4 py-2 rounded border flex-1 text-center;}.link-input[_ngcontent-%COMP%]{@apply flex-1 bg-gray-900 text-white px-4 py-2 rounded border font-mono text-sm;}.copy-button[_ngcontent-%COMP%], .open-link-button[_ngcontent-%COMP%]{@apply bg-primary-cyan-600 hover:bg-primary-cyan-700 text-white p-2 rounded transition-colors;}.spei-field[_ngcontent-%COMP%]{@apply mb-3 flex flex-col;}.spei-field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{@apply mb-1;}.bank-name[_ngcontent-%COMP%], .reference-text[_ngcontent-%COMP%]{@apply text-white font-semibold;}.instructions-box[_ngcontent-%COMP%]{@apply bg-gray-800 rounded-lg p-4;}.instruction-list[_ngcontent-%COMP%]{@apply text-gray-300 space-y-2 list-decimal list-inside;}.payment-options[_ngcontent-%COMP%]{@apply text-gray-300 space-y-2;}.payment-actions[_ngcontent-%COMP%]{@apply flex gap-4 justify-center;}.refresh-button[_ngcontent-%COMP%], .back-button[_ngcontent-%COMP%]{@apply px-4 py-2 rounded-lg font-medium transition-colors;}.refresh-button[_ngcontent-%COMP%]{@apply bg-primary-cyan-600 hover:bg-primary-cyan-700 text-white;}.back-button[_ngcontent-%COMP%]{@apply bg-gray-600 hover:bg-gray-500 text-white;}.payment-completed[_ngcontent-%COMP%]{@apply text-center py-8;}.success-animation[_ngcontent-%COMP%]{@apply mb-6;}.proceed-button[_ngcontent-%COMP%]{@apply bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors;}.expiration-info[_ngcontent-%COMP%]{@apply mt-3 flex items-center justify-center text-center;}"]})};var xe=class i{documentCatalog={ine:{name:"INE Vigente",isRequired:!0,tooltip:"Identificaci\xF3n oficial vigente"},"comprobante-domicilio":{name:"Comprobante de domicilio",isRequired:!0,tooltip:"Recibo de luz, agua, tel\xE9fono o predial no mayor a 3 meses"},"constancia-fiscal":{name:"Constancia de situaci\xF3n fiscal",isRequired:!0,tooltip:"Documento del SAT que acredite la situaci\xF3n fiscal"},concesion:{name:"Copia de la concesi\xF3n",isRequired:!0,tooltip:"Documento oficial que otorga el derecho de operar la ruta"},"tarjeta-circulacion":{name:"Tarjeta de circulaci\xF3n",isRequired:!0,tooltip:"Documento de identificaci\xF3n del veh\xEDculo"},"factura-unidad":{name:"Factura de la unidad actual",isRequired:!0,tooltip:"Comprobante de propiedad de la unidad actual"},"carta-aval":{name:"Carta Aval de Ruta",isRequired:!0,tooltip:"Documento que avala al cliente dentro de la ruta"},"convenio-dacion":{name:"Convenio de Daci\xF3n en Pago",isRequired:!0,tooltip:"Acuerdo legal de garant\xEDa sobre la unidad"},"acta-constitutiva":{name:"Acta Constitutiva de la Ruta",isRequired:!0,tooltip:"Documento legal que constituye la ruta"},"poder-representante":{name:"Poder del Representante Legal",isRequired:!0,tooltip:"Documento que otorga representaci\xF3n legal"},"verificacion-biometrica":{name:"Verificaci\xF3n Biom\xE9trica (Metamap)",isRequired:!0,tooltip:"Validaci\xF3n biom\xE9trica de identidad"}};getRequiredDocuments(t){let{market:e,product:n,clientType:o}=t;if(e==="aguascalientes"){if(n==="venta-directa")return this.getDocuments(["ine","comprobante-domicilio","constancia-fiscal","concesion"]);if(n==="venta-plazo")return this.getDocuments(["ine","comprobante-domicilio","tarjeta-circulacion","concesion","constancia-fiscal"]);if(n==="ahorro-programado")return this.getDocuments(["ine","comprobante-domicilio","tarjeta-circulacion","concesion","constancia-fiscal"])}if(e==="edomex"){if(n==="venta-directa")return this.getDocuments(["ine","comprobante-domicilio","constancia-fiscal"]);if(n==="venta-plazo")return this.getDocuments(["ine","comprobante-domicilio","tarjeta-circulacion","concesion","constancia-fiscal","factura-unidad","carta-aval","convenio-dacion"]);if(n==="ahorro-programado")return this.getDocuments(["ine","comprobante-domicilio","tarjeta-circulacion","concesion"])}return this.getDocuments(["ine","comprobante-domicilio"])}getDocuments(t){return t.map(e=>this.documentCatalog[e]).filter(e=>e!==void 0)}getDocumentByName(t){let e=Object.keys(this.documentCatalog).find(n=>this.documentCatalog[n].name===t);return e?this.documentCatalog[e]:void 0}validateDocumentCompleteness(t,e){let n=this.getRequiredDocuments(t),o=n.filter(h=>e.includes(h.name)),m=n.filter(h=>!e.includes(h.name));return{isComplete:m.length===0,missingDocuments:m,completedDocuments:o}}getDocumentUploadInstructions(t){return{"INE Vigente":"Fotograf\xEDa clara de ambos lados de la credencial INE vigente","Comprobante de domicilio":"Recibo de servicio (luz, agua, tel\xE9fono) no mayor a 3 meses","Constancia de situaci\xF3n fiscal":"Documento oficial del SAT descargado del portal","Copia de la concesi\xF3n":"Documento oficial de la concesi\xF3n de transporte","Tarjeta de circulaci\xF3n":"Fotograf\xEDa clara de la tarjeta de circulaci\xF3n vigente","Factura de la unidad actual":"Factura original de compra de la unidad actual","Carta Aval de Ruta":"Documento firmado por el representante de la ruta","Convenio de Daci\xF3n en Pago":"Documento legal firmado ante notario","Verificaci\xF3n Biom\xE9trica (Metamap)":"Proceso de verificaci\xF3n de identidad biom\xE9trica"}[t]||"Fotograf\xEDa clara y legible del documento"}static \u0275fac=function(e){return new(e||i)};static \u0275prov=F({token:i,factory:i.\u0275fac,providedIn:"root"})};var be=class i{dbName="ConductoresDocumentStorage";dbVersion=1;documentsStore="documents";db=null;initializeDb(){return v(this,null,function*(){return new Promise((t,e)=>{let n=indexedDB.open(this.dbName,this.dbVersion);n.onerror=()=>{console.error("Error opening IndexedDB:",n.error),e(!1)},n.onsuccess=()=>{this.db=n.result,console.log("IndexedDB initialized successfully"),t(!0)},n.onupgradeneeded=o=>{let m=o.target.result;if(!m.objectStoreNames.contains(this.documentsStore)){let h=m.createObjectStore(this.documentsStore,{keyPath:"id"});h.createIndex("clientId","clientId",{unique:!1}),h.createIndex("documentName","documentName",{unique:!1}),h.createIndex("timestamp","timestamp",{unique:!1}),h.createIndex("market","market",{unique:!1}),h.createIndex("product","product",{unique:!1}),console.log("Document store created with indexes")}}})})}storeDocument(t){return v(this,null,function*(){return this.db||(yield this.initializeDb()),new Promise((e,n)=>{let h=this.db.transaction([this.documentsStore],"readwrite").objectStore(this.documentsStore).put(t);h.onsuccess=()=>{console.log("Document stored successfully:",t.documentName),e(!0)},h.onerror=()=>{console.error("Error storing document:",h.error),n(!1)}})})}getDocumentsByClient(t){return v(this,null,function*(){return this.db||(yield this.initializeDb()),new Promise((e,n)=>{let w=this.db.transaction([this.documentsStore],"readonly").objectStore(this.documentsStore).index("clientId").getAll(t);w.onsuccess=()=>{e(w.result||[])},w.onerror=()=>{console.error("Error retrieving documents:",w.error),n([])}})})}getDocument(t){return v(this,null,function*(){return this.db||(yield this.initializeDb()),new Promise((e,n)=>{let h=this.db.transaction([this.documentsStore],"readonly").objectStore(this.documentsStore).get(t);h.onsuccess=()=>{e(h.result||null)},h.onerror=()=>{console.error("Error retrieving document:",h.error),n(null)}})})}deleteDocument(t){return v(this,null,function*(){return this.db||(yield this.initializeDb()),new Promise((e,n)=>{let h=this.db.transaction([this.documentsStore],"readwrite").objectStore(this.documentsStore).delete(t);h.onsuccess=()=>{console.log("Document deleted successfully"),e(!0)},h.onerror=()=>{console.error("Error deleting document:",h.error),n(!1)}})})}getAllClients(){return v(this,null,function*(){return this.db||(yield this.initializeDb()),new Promise((t,e)=>{let m=this.db.transaction([this.documentsStore],"readonly").objectStore(this.documentsStore).getAll();m.onsuccess=()=>{let h=m.result||[],w=new Map;h.forEach(k=>{w.has(k.clientId)||w.set(k.clientId,{clientId:k.clientId,clientName:`Cliente ${k.clientId}`,documents:[],totalSize:0,lastModified:k.timestamp});let $=w.get(k.clientId);$.documents.push(k),$.totalSize+=k.size,k.timestamp>$.lastModified&&($.lastModified=k.timestamp)}),t(Array.from(w.values()))},m.onerror=()=>{console.error("Error retrieving all clients:",m.error),e([])}})})}getTotalStorageUsed(){return v(this,null,function*(){return this.db||(yield this.initializeDb()),new Promise((t,e)=>{let m=this.db.transaction([this.documentsStore],"readonly").objectStore(this.documentsStore).getAll();m.onsuccess=()=>{let w=(m.result||[]).reduce((k,$)=>k+$.size,0);t(w)},m.onerror=()=>{console.error("Error calculating storage usage:",m.error),e(0)}})})}clearClientDocuments(t){return v(this,null,function*(){this.db||(yield this.initializeDb());try{let n=(yield this.getDocumentsByClient(t)).map(o=>this.deleteDocument(o.id));return yield Promise.all(n),!0}catch(e){return console.error("Error clearing client documents:",e),!1}})}fileToBase64(t){return v(this,null,function*(){return new Promise((e,n)=>{let o=new FileReader;o.onload=()=>{let h=o.result.split(",")[1];e(h)},o.onerror=()=>n(o.error),o.readAsDataURL(t)})})}base64ToFile(t,e,n){let o=atob(t),m=new Array(o.length);for(let w=0;w<o.length;w++)m[w]=o.charCodeAt(w);let h=new Uint8Array(m);return new File([h],e,{type:n})}formatFileSize(t){if(t===0)return"0 Bytes";let e=1024,n=["Bytes","KB","MB","GB"],o=Math.floor(Math.log(t)/Math.log(e));return parseFloat((t/Math.pow(e,o)).toFixed(2))+" "+n[o]}generateDocumentId(t,e){let n=new Date().getTime(),o=Math.random().toString(36).substring(2,8);return`${t}_${e.replace(/\s+/g,"_")}_${n}_${o}`}static \u0275fac=function(e){return new(e||i)};static \u0275prov=F({token:i,factory:i.\u0275fac,providedIn:"root"})};var wt=["videoElement"],Dt=["canvasElement"],Pt=["fileInput"],Mt=(i,t)=>t.name;function kt(i,t){if(i&1&&(d(0,"div")(1,"span",13),a(2,"Tipo:"),l(),d(3,"div",14),a(4),l()()),i&2){let e=p();r(4),y(e.configuration.clientType)}}function It(i,t){i&1&&(d(0,"div",26),J(),d(1,"svg",36),D(2,"path",37),l()())}function Ot(i,t){i&1&&(d(0,"div",27),D(1,"div",38),l())}function Rt(i,t){if(i&1&&(d(0,"p",29),a(1),l()),i&2){let e=p().$implicit;r(),y(e.tooltip)}}function Tt(i,t){i&1&&(d(0,"span",30),a(1," Completado "),l())}function Vt(i,t){i&1&&(d(0,"span",31),a(1," Requerido "),l())}function Ft(i,t){i&1&&(d(0,"span",32),a(1," Opcional "),l())}function Nt(i,t){if(i&1&&D(0,"img",40),i&2){let e=p();T("src","data:"+e.fileType+";base64,"+e.fileData,me)}}function At(i,t){i&1&&(d(0,"div",41),J(),d(1,"svg",44),D(2,"path",45),l()())}function qt(i,t){if(i&1){let e=x();d(0,"div",34)(1,"div",39)(2,"div",24)(3,"div",25),u(4,Nt,1,1,"img",40)(5,At,3,0,"div",41),l(),d(6,"div")(7,"div",28),a(8),l(),d(9,"div",42),a(10),l()()(),d(11,"button",43),S("click",function(){let o=f(e),m=p(2);return _(m.removeDocument(o.id))}),a(12," Eliminar "),l()()()}if(i&2){let e=t,n=p(2);r(4),g(e.fileType.startsWith("image/")?4:5),r(4),y(e.fileName),r(2),re(" ",n.formatFileSize(e.size)," \u2022 ",n.formatDate(e.timestamp)," ")}}function jt(i,t){if(i&1){let e=x();d(0,"div",35)(1,"button",46),S("click",function(){f(e);let o=p().$implicit,m=p();return _(m.startCameraCapture(o.name))}),J(),d(2,"svg",47),D(3,"path",48)(4,"path",49),l(),ae(),d(5,"span"),a(6,"Fotografiar"),l()(),d(7,"button",50),S("click",function(){f(e);let o=p().$implicit,m=p();return _(m.triggerFileInput(o.name))}),J(),d(8,"svg",47),D(9,"path",51),l(),ae(),d(10,"span"),a(11,"Subir Archivo"),l()()()}if(i&2){let e=p(2);r(),T("disabled",e.isCapturing())}}function Lt(i,t){if(i&1&&(d(0,"div",22)(1,"div",23)(2,"div",24)(3,"div",25),u(4,It,3,0,"div",26)(5,Ot,2,0,"div",27),l(),d(6,"div")(7,"h3",28),a(8),l(),u(9,Rt,2,1,"p",29),l()(),u(10,Tt,2,0,"span",30)(11,Vt,2,0,"span",31)(12,Ft,2,0,"span",32),l(),d(13,"div",33),a(14),l(),u(15,qt,13,4,"div",34),u(16,jt,12,1,"div",35),l()),i&2){let e,n=t.$implicit,o=p();K("bg-green-50",o.isDocumentCompleted(n.name))("border-green-300",o.isDocumentCompleted(n.name))("bg-white",!o.isDocumentCompleted(n.name))("border-gray-200",!o.isDocumentCompleted(n.name)),r(4),g(o.isDocumentCompleted(n.name)?4:5),r(4),y(n.name),r(),g(n.tooltip?9:-1),r(),g(o.isDocumentCompleted(n.name)?10:n.isRequired?11:12),r(4),E(" ",o.getUploadInstructions(n.name)," "),r(),g((e=o.getStoredDocument(n.name))?15:-1,e),r(),g(o.isDocumentCompleted(n.name)?-1:16)}}function Kt(i,t){if(i&1){let e=x();d(0,"div",18)(1,"div",52)(2,"div",53)(3,"h3",54),a(4),l(),d(5,"button",55),S("click",function(){f(e);let o=p();return _(o.closeCamera())}),J(),d(6,"svg",56),D(7,"path",57),l()()(),ae(),d(8,"div",58),D(9,"video",59,2),l(),d(11,"div",60)(12,"button",61),S("click",function(){f(e);let o=p();return _(o.capturePhoto())}),J(),d(13,"svg",62),D(14,"path",49),l(),ae(),d(15,"span"),a(16,"Capturar"),l()(),d(17,"button",63),S("click",function(){f(e);let o=p();return _(o.closeCamera())}),a(18," Cancelar "),l()()()()}if(i&2){let e=p();r(4),E("Capturar ",e.currentDocumentName())}}function zt(i,t){i&1&&(d(0,"div",19)(1,"div",64),D(2,"div",65),d(3,"p",66),a(4,"Guardando documento..."),l()()())}var ve=class i{constructor(t,e,n){this.documentRulesEngine=t;this.makeIntegration=e;this.indexedDbService=n}clientId;clientName;configuration;documentCaptured=new A;documentsUpdated=new A;videoElement;canvasElement;fileInput;storedDocuments=b([]);requiredDocs=b([]);showCamera=b(!1);currentDocumentName=b("");isCapturing=b(!1);mediaStream=null;currentDocumentForUpload="";requiredDocuments=X(()=>this.requiredDocs());completedDocuments=X(()=>this.requiredDocs().filter(t=>this.storedDocuments().some(e=>e.documentName===t.name)));completionPercentage=X(()=>{let t=this.requiredDocs().length,e=this.completedDocuments().length;return t>0?Math.round(e/t*100):0});ngOnInit(){return v(this,null,function*(){yield this.loadRequiredDocuments(),yield this.loadStoredDocuments()})}ngOnDestroy(){this.closeCamera()}loadRequiredDocuments(){return v(this,null,function*(){let t=this.documentRulesEngine.getRequiredDocuments(this.configuration);this.requiredDocs.set(t)})}loadStoredDocuments(){return v(this,null,function*(){try{let t=yield this.indexedDbService.getDocumentsByClient(this.clientId);this.storedDocuments.set(t)}catch(t){console.error("Error loading stored documents:",t)}})}isDocumentCompleted(t){return this.storedDocuments().some(e=>e.documentName===t)}getStoredDocument(t){return this.storedDocuments().find(e=>e.documentName===t)}getUploadInstructions(t){return this.documentRulesEngine.getDocumentUploadInstructions(t)}startCameraCapture(t){return v(this,null,function*(){this.currentDocumentName.set(t),this.showCamera.set(!0);try{this.mediaStream=yield navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}}}),setTimeout(()=>{this.videoElement?.nativeElement&&this.mediaStream&&(this.videoElement.nativeElement.srcObject=this.mediaStream)},100)}catch(e){console.error("Error accessing camera:",e),alert("No se pudo acceder a la c\xE1mara. Por favor, usa la opci\xF3n de subir archivo."),this.closeCamera()}})}closeCamera(){this.showCamera.set(!1),this.currentDocumentName.set(""),this.mediaStream&&(this.mediaStream.getTracks().forEach(t=>t.stop()),this.mediaStream=null)}capturePhoto(){return v(this,null,function*(){let t=this.videoElement.nativeElement,e=this.canvasElement.nativeElement,n=e.getContext("2d");e.width=t.videoWidth,e.height=t.videoHeight,n.drawImage(t,0,0),this.isCapturing.set(!0);try{let o=yield new Promise(w=>{e.toBlob(k=>w(k),"image/jpeg",.8)}),m=`${this.currentDocumentName()}_${new Date().getTime()}.jpg`,h=new File([o],m,{type:"image/jpeg"});yield this.saveDocument(this.currentDocumentName(),h),this.closeCamera()}catch(o){console.error("Error capturing photo:",o),alert("Error al capturar la foto. Intenta de nuevo.")}finally{this.isCapturing.set(!1)}})}triggerFileInput(t){this.currentDocumentForUpload=t,this.fileInput.nativeElement.click()}onFileSelected(t){return v(this,null,function*(){let e=t.target,n=e.files?.[0];if(n){this.isCapturing.set(!0);try{yield this.saveDocument(this.currentDocumentForUpload,n)}catch(o){console.error("Error saving file:",o),alert("Error al guardar el archivo. Intenta de nuevo.")}finally{this.isCapturing.set(!1)}}e.value="",this.currentDocumentForUpload=""})}saveDocument(t,e){return v(this,null,function*(){try{let n=yield this.indexedDbService.fileToBase64(e),o={id:this.indexedDbService.generateDocumentId(this.clientId,t),clientId:this.clientId,documentName:t,fileName:e.name,fileType:e.type,fileData:n,timestamp:new Date,size:e.size,market:this.configuration.market,product:this.configuration.product};yield this.indexedDbService.storeDocument(o),yield this.loadStoredDocuments(),this.makeIntegration.sendDocumentUpload({clientId:this.clientId,documentName:t,fileName:e.name,fileType:e.type,fileSize:e.size,timestamp:new Date,market:this.configuration.market,product:this.configuration.product}).pipe(U(m=>(console.warn("Make.com webhook failed (non-critical):",m),L(null)))).subscribe(),this.documentCaptured.emit({name:t,file:e,timestamp:new Date}),this.documentsUpdated.emit()}catch(n){throw console.error("Error saving document:",n),n}})}removeDocument(t){return v(this,null,function*(){if(confirm("\xBFEst\xE1s seguro de que quieres eliminar este documento?"))try{yield this.indexedDbService.deleteDocument(t),yield this.loadStoredDocuments(),this.documentsUpdated.emit()}catch(e){console.error("Error removing document:",e),alert("Error al eliminar el documento. Intenta de nuevo.")}})}formatFileSize(t){return this.indexedDbService.formatFileSize(t)}formatDate(t){return new Intl.DateTimeFormat("es-MX",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(new Date(t))}static \u0275fac=function(e){return new(e||i)(I(xe),I(z),I(be))};static \u0275cmp=N({type:i,selectors:[["app-document-capture"]],viewQuery:function(e,n){if(e&1&&(Z(wt,5),Z(Dt,5),Z(Pt,5)),e&2){let o;ee(o=te())&&(n.videoElement=o.first),ee(o=te())&&(n.canvasElement=o.first),ee(o=te())&&(n.fileInput=o.first)}},inputs:{clientId:"clientId",clientName:"clientName",configuration:"configuration"},outputs:{documentCaptured:"documentCaptured",documentsUpdated:"documentsUpdated"},decls:33,vars:11,consts:[["fileInput",""],["canvasElement",""],["videoElement",""],[1,"bg-white","rounded-lg","shadow-lg","p-4","sm:p-6","max-w-full","sm:max-w-4xl","mx-auto"],[1,"flex","flex-col","sm:flex-row","justify-between","items-start","sm:items-center","mb-4","sm:mb-6","space-y-2","sm:space-y-0"],[1,"text-lg","sm:text-xl","font-semibold","text-gray-900"],[1,"text-sm","text-gray-500","bg-gray-100","px-3","py-1","rounded-full"],[1,"mb-6"],[1,"bg-gray-200","rounded-full","h-2"],[1,"bg-primary-cyan-400","h-2","rounded-full","transition-all","duration-300"],[1,"text-center","mt-2","text-sm","text-gray-600"],[1,"mb-4","sm:mb-6","p-3","sm:p-4","bg-gray-50","rounded-lg"],[1,"grid","grid-cols-1","sm:grid-cols-3","gap-2","sm:gap-4","text-sm"],[1,"font-medium","text-gray-700"],[1,"text-gray-900","capitalize"],[4,"ngIf"],[1,"space-y-4"],[1,"border","rounded-lg","p-3","sm:p-4","transition-all","duration-200",3,"bg-green-50","border-green-300","bg-white","border-gray-200"],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50","p-4"],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50"],["type","file","accept","image/*,.pdf",2,"display","none",3,"change"],[2,"display","none"],[1,"border","rounded-lg","p-3","sm:p-4","transition-all","duration-200"],[1,"flex","items-center","justify-between","mb-3"],[1,"flex","items-center","space-x-3"],[1,"flex-shrink-0"],[1,"w-6","h-6","bg-green-500","rounded-full","flex","items-center","justify-center"],[1,"w-6","h-6","border-2","border-gray-300","rounded-full","flex","items-center","justify-center"],[1,"font-medium","text-gray-900"],[1,"text-sm","text-gray-600"],[1,"bg-green-100","text-green-800","text-xs","font-medium","px-2.5","py-0.5","rounded-full"],[1,"bg-red-100","text-red-800","text-xs","font-medium","px-2.5","py-0.5","rounded-full"],[1,"bg-yellow-100","text-yellow-800","text-xs","font-medium","px-2.5","py-0.5","rounded-full"],[1,"mb-3","text-sm","text-gray-600"],[1,"mb-3","p-3","bg-gray-50","rounded-lg","border"],[1,"flex","flex-col","sm:flex-row","space-y-2","sm:space-y-0","sm:space-x-2"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","text-white"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7"],[1,"w-3","h-3","bg-gray-300","rounded-full"],[1,"flex","items-center","justify-between"],["alt","Document preview",1,"w-12","h-12","object-cover","rounded","border",3,"src"],[1,"w-12","h-12","bg-gray-200","rounded","border","flex","items-center","justify-center"],[1,"text-sm","text-gray-500"],["type","button",1,"text-red-600","hover:text-red-800","text-sm","font-medium",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","text-gray-500"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"],["type","button",1,"flex-1","bg-primary-cyan-600","hover:bg-primary-cyan-700","active:bg-primary-cyan-800","disabled:opacity-50","disabled:cursor-not-allowed","text-white","px-4","py-3","sm:py-2","rounded-lg","font-medium","text-sm","flex","items-center","justify-center","space-x-2","min-h-[44px]","touch-manipulation",3,"click","disabled"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","sm:w-4","sm:h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 13a3 3 0 11-6 0 3 3 0 016 0z"],["type","button",1,"flex-1","bg-gray-600","hover:bg-gray-700","active:bg-gray-800","text-white","px-4","py-3","sm:py-2","rounded-lg","font-medium","text-sm","flex","items-center","justify-center","space-x-2","min-h-[44px]","touch-manipulation",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"],[1,"bg-white","rounded-lg","p-4","sm:p-6","w-full","max-w-sm","sm:max-w-lg","max-h-[90vh]","flex","flex-col"],[1,"flex","justify-between","items-center","mb-4"],[1,"text-lg","font-semibold","truncate","pr-2"],["type","button",1,"text-gray-500","hover:text-gray-700","p-1","min-h-[44px]","min-w-[44px]","flex","items-center","justify-center","touch-manipulation",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"mb-4","flex-1","flex","items-center","justify-center"],["autoplay","","playsinline","",1,"w-full","max-h-[40vh]","sm:max-h-[50vh]","rounded-lg","border","bg-black","object-cover"],[1,"flex","flex-col","sm:flex-row","justify-center","space-y-2","sm:space-y-0","sm:space-x-4"],["type","button",1,"bg-primary-cyan-600","hover:bg-primary-cyan-700","active:bg-primary-cyan-800","text-white","px-6","py-3","sm:py-2","rounded-lg","font-medium","flex","items-center","justify-center","space-x-2","min-h-[44px]","touch-manipulation",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["type","button",1,"bg-gray-600","hover:bg-gray-700","active:bg-gray-800","text-white","px-6","py-3","sm:py-2","rounded-lg","font-medium","min-h-[44px]","touch-manipulation",3,"click"],[1,"bg-white","rounded-lg","p-6","text-center"],[1,"animate-spin","rounded-full","h-8","w-8","border-b-2","border-primary-cyan-600","mx-auto","mb-4"],[1,"text-gray-600"]],template:function(e,n){if(e&1){let o=x();d(0,"div",3)(1,"div",4)(2,"h2",5),a(3),l(),d(4,"div",6),a(5),l()(),d(6,"div",7)(7,"div",8),D(8,"div",9),l(),d(9,"div",10),a(10),l()(),d(11,"div",11)(12,"div",12)(13,"div")(14,"span",13),a(15,"Mercado:"),l(),d(16,"div",14),a(17),l()(),d(18,"div")(19,"span",13),a(20,"Producto:"),l(),d(21,"div",14),a(22),l()(),Oe(23,kt,5,1,"div",15),l()(),d(24,"div",16),H(25,Lt,17,15,"div",17,Mt),l(),u(27,Kt,19,1,"div",18),u(28,zt,5,0,"div",19),d(29,"input",20,0),S("change",function(h){return f(o),_(n.onFileSelected(h))}),l(),D(31,"canvas",21,1),l()}e&2&&(r(3),E(" Documentos Requeridos - ",n.clientName," "),r(2),re(" ",n.completedDocuments().length," / ",n.requiredDocuments().length," completados "),r(3),G("width",n.completionPercentage(),"%"),r(2),E(" ",n.completionPercentage(),"% completado "),r(7),y(n.configuration.market),r(5),y(n.configuration.product.replace("-"," ")),r(),T("ngIf",n.configuration.clientType),r(2),B(n.requiredDocuments()),r(2),g(n.showCamera()?27:-1),r(),g(n.isCapturing()?28:-1))},dependencies:[q,Re,ie],styles:["[_nghost-%COMP%]{display:block}"]})};var ye=class i{constructor(t){this.http=t}API_URL=`${V.apiUrl}/kinban-scoring`;CACHE_DURATION=720*60*60*1e3;scoreCache=new Map;SIMULATION_DELAY=3e3;BASE_SCORE=75;SCORE_VARIANCE=15;calculateScore(t){let e=this.getCachedScore(t.clientId);return e&&this.isScoreValid(e)?L(e.score).pipe(Ee(500)):this.simulateScoring(t).pipe(Ee(this.SIMULATION_DELAY),Ie(n=>(this.cacheScore(t.clientId,n),n)))}getCachedScore(t){let e=this.scoreCache.get(t);return e&&this.isScoreValid(e)?e:null}isScoreValid(t){return Date.now()-t.createdAt.getTime()<this.CACHE_DURATION&&t.isValid}cacheScore(t,e){this.scoreCache.set(t,{clientId:t,score:e,createdAt:new Date,isValid:!0})}simulateScoring(t){return new ke(e=>{let n=Date.now(),o=this.calculateIdentityScore(t),m=this.calculateCreditworthinessScore(t),h=this.calculateBusinessViabilityScore(t),w=this.calculateDocumentationScore(t),k=o+m+h+w,$=(Math.random()-.5)*2*this.SCORE_VARIANCE,Pe=Math.max(0,Math.min(100,Math.round(k+$))),{level:je,color:Le,status:Me,riskLevel:Ke}=this.determineScoreLevel(Pe),ze=this.generateRecommendations(t,{identity:o,creditworthiness:m,businessViability:h,documentation:w}),Ue=this.generateNextSteps(Me,t),He={clientId:t.clientId,score:Pe,level:je,color:Le,status:Me,factors:{identity:o,creditworthiness:m,businessViability:h,documentation:w},recommendations:ze,nextSteps:Ue,riskLevel:Ke,timestamp:new Date,processingTime:Date.now()-n};e.next(He),e.complete()})}calculateIdentityScore(t){let e=15;return t.personalInfo.rfc&&t.personalInfo.rfc.length>=12&&(e+=5),t.personalInfo.email&&t.personalInfo.email.includes("@")&&(e+=3),t.personalInfo.phone&&t.personalInfo.phone.length>=10&&(e+=2),Math.min(25,e)}calculateCreditworthinessScore(t){let e=18;return t.businessInfo.market==="aguascalientes"&&(e+=2),t.businessInfo.product==="venta-directa"?e+=3:t.businessInfo.product==="credito-colectivo"&&(e+=1),t.businessInfo.monthlyIncome&&t.businessInfo.requestedAmount&&t.businessInfo.requestedAmount/(t.businessInfo.monthlyIncome*12)<.3&&(e+=2),Math.min(25,e)}calculateBusinessViabilityScore(t){let e=17;return t.businessInfo.market==="edomex"&&t.businessInfo.product==="credito-colectivo"&&(e+=3),(t.businessInfo.product==="venta-plazo"||t.businessInfo.product==="ahorro-programado")&&(e+=2),e+=Math.floor(Math.random()*4),Math.min(25,e)}calculateDocumentationScore(t){let e=10,n=t.documentsInfo.totalDocuments>0?t.documentsInfo.completedDocuments/t.documentsInfo.totalDocuments:0;return e+=Math.floor(n*10),t.documentsInfo.hasINE&&(e+=2),t.documentsInfo.hasProofOfAddress&&(e+=1),t.documentsInfo.hasRFC&&(e+=1),t.documentsInfo.hasMetamap&&(e+=1),Math.min(25,e)}determineScoreLevel(t){return t>=80?{level:"excellent",color:"green",status:"approved",riskLevel:"low"}:t>=70?{level:"good",color:"green",status:"approved",riskLevel:"low"}:t>=60?{level:"fair",color:"yellow",status:"conditional",riskLevel:"medium"}:t>=40?{level:"poor",color:"orange",status:"review",riskLevel:"high"}:{level:"rejected",color:"red",status:"rejected",riskLevel:"very-high"}}generateRecommendations(t,e){let n=[];return e.identity<20&&n.push("Completar informaci\xF3n de identificaci\xF3n (RFC, email, tel\xE9fono)"),e.documentation<20&&n.push("Completar documentaci\xF3n requerida para el producto seleccionado"),e.creditworthiness<20&&n.push("Considerar un enganche mayor para mejorar el perfil crediticio"),e.businessViability<20&&n.push("Revisar la viabilidad del modelo de negocio propuesto"),n.length===0&&(n.push("Perfil crediticio excelente"),n.push("Documentaci\xF3n completa y verificada"),n.push("Listo para continuar con el proceso de financiamiento")),n}generateNextSteps(t,e){let n=[];switch(t){case"approved":n.push("\u2705 Continuar con el proceso de pago de enganche"),n.push("\u{1F4C4} Preparar documentos para firma de contrato"),n.push("\u{1F69B} Programar entrega de unidad");break;case"conditional":n.push("\u{1F4CB} Completar documentaci\xF3n pendiente"),n.push("\u{1F4B0} Revisar t\xE9rminos de financiamiento"),n.push("\u{1F504} Re-evaluar score una vez completados los requisitos");break;case"review":n.push("\u{1F465} Programar reuni\xF3n con equipo comercial"),n.push("\u{1F4CA} An\xE1lisis detallado del caso"),n.push("\u2696\uFE0F Evaluaci\xF3n manual de riesgos");break;case"rejected":n.push("\u274C Solicitud no aprobada en este momento"),n.push("\u{1F4DE} Contactar para explorar alternativas"),n.push("\u{1F504} Re-aplicar en el futuro con mejor perfil");break}return n}getAllCachedScores(){return Array.from(this.scoreCache.values()).filter(t=>this.isScoreValid(t))}clearScoreCache(t){this.scoreCache.delete(t)}clearAllCache(){this.scoreCache.clear()}static \u0275fac=function(e){return new(e||i)(W(Q))};static \u0275prov=F({token:i,factory:i.\u0275fac,providedIn:"root"})};function Ht(i,t){if(i&1&&(s(0,"div",7)(1,"div",10)(2,"div",11),C(3,"i",12),c()(),s(4,"h4",13),a(5,"Procesando Evaluaci\xF3n Crediticia"),c(),s(6,"p",14),a(7,"Analizando perfil del cliente con algoritmos KINBAN/HASE..."),c(),s(8,"div",15)(9,"div",16),C(10,"i",17),s(11,"span"),a(12,"Validaci\xF3n de Identidad"),c()(),s(13,"div",16),C(14,"i",18),s(15,"span"),a(16,"An\xE1lisis Crediticio"),c()(),s(17,"div",16),C(18,"i",19),s(19,"span"),a(20,"Viabilidad de Negocio"),c()(),s(21,"div",16),C(22,"i",20),s(23,"span"),a(24,"Documentaci\xF3n"),c()()(),s(25,"div",21),C(26,"div",22),c(),s(27,"p",23),a(28),c()()),i&2){let e=p();r(9),K("completed",e.processingStep()>=1),r(4),K("completed",e.processingStep()>=2),r(4),K("completed",e.processingStep()>=3),r(4),K("completed",e.processingStep()>=4),r(5),G("width",e.progressPercentage(),"%"),r(2),E("",e.progressPercentage(),"% completado")}}function Bt(i,t){if(i&1&&(s(0,"li"),a(1),c()),i&2){let e=t.$implicit;r(),y(e)}}function Xt(i,t){if(i&1&&(s(0,"div",44)(1,"h5",33),C(2,"i",58),a(3," Recomendaciones "),c(),s(4,"ul",59),H(5,Bt,2,1,"li",null,we),c()()),i&2){let e=p(2);r(5),B(e.scoreResult().recommendations)}}function $t(i,t){if(i&1&&(s(0,"li"),a(1),c()),i&2){let e=t.$implicit;r(),y(e)}}function Wt(i,t){if(i&1){let e=x();s(0,"button",60),O("click",function(){f(e);let o=p(2);return _(o.continueOnboarding())}),C(1,"i",61),a(2," Continuar con Onboarding "),c()}}function Yt(i,t){if(i&1){let e=x();s(0,"button",62),O("click",function(){f(e);let o=p(2);return _(o.reviewCase())}),C(1,"i",63),a(2," Revisar Caso "),c()}}function Gt(i,t){if(i&1){let e=x();s(0,"div",8)(1,"div",24)(2,"div",25)(3,"div",26),a(4),c(),s(5,"div",27),a(6,"/ 100"),c()(),s(7,"div",28)(8,"h4",29),a(9),c(),s(10,"p",30),a(11),c(),s(12,"div",31),C(13,"i"),a(14),c()()(),s(15,"div",32)(16,"h5",33),a(17,"Desglose de Evaluaci\xF3n"),c(),s(18,"div",34)(19,"div",35)(20,"div",36),C(21,"i",37),s(22,"span"),a(23,"Identidad"),c()(),s(24,"div",38),a(25),c(),s(26,"div",39),C(27,"div",40),c()(),s(28,"div",35)(29,"div",36),C(30,"i",41),s(31,"span"),a(32,"Solvencia"),c()(),s(33,"div",38),a(34),c(),s(35,"div",39),C(36,"div",40),c()(),s(37,"div",35)(38,"div",36),C(39,"i",42),s(40,"span"),a(41,"Negocio"),c()(),s(42,"div",38),a(43),c(),s(44,"div",39),C(45,"div",40),c()(),s(46,"div",35)(47,"div",36),C(48,"i",43),s(49,"span"),a(50,"Documentos"),c()(),s(51,"div",38),a(52),c(),s(53,"div",39),C(54,"div",40),c()()()(),u(55,Xt,7,0,"div",44),s(56,"div",45)(57,"h5",33),C(58,"i",46),a(59," Pr\xF3ximos Pasos "),c(),s(60,"ul",47),H(61,$t,2,1,"li",null,we),c()(),s(63,"div",48)(64,"div",49)(65,"div",50),C(66,"i",51),s(67,"span"),a(68),c()(),s(69,"div",50),C(70,"i",52),s(71,"span"),a(72),c()()()(),s(73,"div",53),u(74,Wt,3,0,"button",54),u(75,Yt,3,0,"button",55),s(76,"button",56),O("click",function(){f(e);let o=p();return _(o.recalculateScore())}),C(77,"i",57),a(78," Recalcular Score "),c()()()}if(i&2){let e=p();r(),R(e.getScoreColorClass(e.scoreResult().color)),r(3),y(e.scoreResult().score),r(5),y(e.getScoreLevelText(e.scoreResult().level)),r(2),y(e.getStatusText(e.scoreResult().status)),r(),R(e.getRiskColorClass(e.scoreResult().riskLevel)),r(),R(e.getRiskIcon(e.scoreResult().riskLevel)),r(),E(" Riesgo: ",e.getRiskText(e.scoreResult().riskLevel)," "),r(11),E("",e.scoreResult().factors.identity,"/25"),r(2),G("width",e.scoreResult().factors.identity/25*100,"%"),r(7),E("",e.scoreResult().factors.creditworthiness,"/25"),r(2),G("width",e.scoreResult().factors.creditworthiness/25*100,"%"),r(7),E("",e.scoreResult().factors.businessViability,"/25"),r(2),G("width",e.scoreResult().factors.businessViability/25*100,"%"),r(7),E("",e.scoreResult().factors.documentation,"/25"),r(2),G("width",e.scoreResult().factors.documentation/25*100,"%"),r(),g(e.scoreResult().recommendations.length>0?55:-1),r(6),B(e.scoreResult().nextSteps),r(7),E("Tiempo de procesamiento: ",e.scoreResult().processingTime,"ms"),r(4),E("Evaluado: ",e.formatDate(e.scoreResult().timestamp)),r(2),g(e.scoreResult().status==="approved"?74:-1),r(),g(e.scoreResult().status==="conditional"||e.scoreResult().status==="review"?75:-1),r(),Y("disabled",e.isProcessing())}}function Qt(i,t){if(i&1){let e=x();s(0,"div",9),C(1,"i",64),s(2,"h4",13),a(3,"Error en la Evaluaci\xF3n"),c(),s(4,"p",14),a(5),c(),s(6,"button",65),O("click",function(){f(e);let o=p();return _(o.retryScoring())}),C(7,"i",66),a(8," Intentar Nuevamente "),c()()}if(i&2){let e=p();r(5),y(e.error())}}var Se=class i{constructor(t,e){this.kinbanScoringService=t;this.makeIntegration=e}clientId;clientName;scoreRequest;scoringCompleted=new A;continueFlow=new A;reviewRequired=new A;isProcessing=b(!1);scoreResult=b(null);error=b(null);processingStep=b(0);progressPercentage=X(()=>this.processingStep()/4*100);ngOnInit(){let t=this.kinbanScoringService.getCachedScore(this.clientId);t?(this.scoreResult.set(t.score),this.scoringCompleted.emit(t.score)):this.startScoring()}startScoring(){this.isProcessing.set(!0),this.error.set(null),this.scoreResult.set(null),this.simulateProcessingSteps(),this.kinbanScoringService.calculateScore(this.scoreRequest).subscribe({next:t=>{this.isProcessing.set(!1),this.scoreResult.set(t),this.scoringCompleted.emit(t),this.makeIntegration.sendScoringComplete({clientId:this.clientId,score:t.score,level:t.level,status:t.status,riskLevel:t.riskLevel,timestamp:new Date}).pipe(U(e=>(console.warn("Make.com webhook failed (non-critical):",e),L(null)))).subscribe()},error:t=>{this.isProcessing.set(!1),this.error.set("Error al procesar la evaluaci\xF3n crediticia. Por favor, intenta nuevamente."),console.error("Scoring error:",t)}})}simulateProcessingSteps(){setTimeout(()=>this.processingStep.set(1),750),setTimeout(()=>this.processingStep.set(2),750*2),setTimeout(()=>this.processingStep.set(3),750*3),setTimeout(()=>this.processingStep.set(4),750*4)}continueOnboarding(){this.continueFlow.emit()}reviewCase(){let t=this.scoreResult();t&&this.reviewRequired.emit(t)}recalculateScore(){this.kinbanScoringService.clearScoreCache(this.clientId),this.processingStep.set(0),this.startScoring()}retryScoring(){this.startScoring()}getScoreColorClass(t){return t}getScoreLevelText(t){return{excellent:"Excelente",good:"Bueno",fair:"Regular",poor:"Pobre",rejected:"Rechazado"}[t]||t}getStatusText(t){return{approved:"Aprobado para financiamiento",conditional:"Aprobaci\xF3n condicional",review:"Requiere revisi\xF3n manual",rejected:"No aprobado"}[t]||t}getRiskColorClass(t){return{low:"low",medium:"medium",high:"high","very-high":"very-high"}[t]||"medium"}getRiskIcon(t){return{low:"fas fa-shield-alt",medium:"fas fa-exclamation-triangle",high:"fas fa-exclamation-circle","very-high":"fas fa-times-circle"}[t]||"fas fa-exclamation-triangle"}getRiskText(t){return{low:"Bajo",medium:"Medio",high:"Alto","very-high":"Muy Alto"}[t]||t}formatDate(t){return new Intl.DateTimeFormat("es-MX",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(new Date(t))}static \u0275fac=function(e){return new(e||i)(I(ye),I(z))};static \u0275cmp=N({type:i,selectors:[["app-kinban-scoring"]],inputs:{clientId:"clientId",clientName:"clientName",scoreRequest:"scoreRequest"},outputs:{scoringCompleted:"scoringCompleted",continueFlow:"continueFlow",reviewRequired:"reviewRequired"},decls:13,vars:3,consts:[[1,"kinban-scoring-container"],[1,"scoring-header"],[1,"flex","items-center","gap-3","mb-4"],[1,"kinban-logo"],[1,"fas","fa-shield-alt","text-blue-500","text-2xl"],[1,"text-lg","font-semibold","text-white"],[1,"text-sm","text-gray-400"],[1,"processing-state"],[1,"score-results"],[1,"error-state"],[1,"processing-animation"],[1,"kinban-spinner"],[1,"fas","fa-cog","fa-spin","text-blue-400","text-4xl","mb-4"],[1,"text-lg","font-semibold","text-white","mb-2"],[1,"text-gray-300","mb-4"],[1,"processing-steps"],[1,"step"],[1,"fas","fa-user-check"],[1,"fas","fa-credit-card"],[1,"fas","fa-building"],[1,"fas","fa-file-alt"],[1,"progress-bar"],[1,"progress-fill"],[1,"text-xs","text-gray-400","mt-2"],[1,"main-score"],[1,"score-circle"],[1,"score-number"],[1,"score-label"],[1,"score-info"],[1,"score-level"],[1,"score-status"],[1,"risk-indicator"],[1,"factors-breakdown"],[1,"text-white","font-semibold","mb-3"],[1,"factors-grid"],[1,"factor-item"],[1,"factor-header"],[1,"fas","fa-user-check","text-blue-400"],[1,"factor-score"],[1,"factor-bar"],[1,"factor-fill"],[1,"fas","fa-credit-card","text-green-400"],[1,"fas","fa-building","text-purple-400"],[1,"fas","fa-file-alt","text-yellow-400"],[1,"recommendations"],[1,"next-steps"],[1,"fas","fa-route","text-blue-400","mr-2"],[1,"steps-list"],[1,"processing-info"],[1,"info-grid"],[1,"info-item"],[1,"fas","fa-clock","text-gray-400"],[1,"fas","fa-calendar","text-gray-400"],[1,"action-buttons"],[1,"continue-button"],[1,"review-button"],[1,"recalculate-button",3,"click","disabled"],[1,"fas","fa-refresh","mr-2"],[1,"fas","fa-lightbulb","text-yellow-400","mr-2"],[1,"recommendation-list"],[1,"continue-button",3,"click"],[1,"fas","fa-arrow-right","mr-2"],[1,"review-button",3,"click"],[1,"fas","fa-eye","mr-2"],[1,"fas","fa-exclamation-triangle","text-red-400","text-3xl","mb-3"],[1,"retry-button",3,"click"],[1,"fas","fa-redo","mr-2"]],template:function(e,n){e&1&&(s(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),C(4,"i",4),c(),s(5,"div")(6,"h3",5),a(7,"Evaluaci\xF3n Crediticia KINBAN/HASE"),c(),s(8,"p",6),a(9,"Sistema automatizado de scoring crediticio"),c()()()(),u(10,Ht,29,11,"div",7),u(11,Gt,79,28,"div",8),u(12,Qt,9,1,"div",9),c()),e&2&&(r(10),g(n.isProcessing()?10:-1),r(),g(n.scoreResult()&&!n.isProcessing()?11:-1),r(),g(n.error()?12:-1))},dependencies:[q],styles:['@charset "UTF-8";.kinban-scoring-container[_ngcontent-%COMP%]{@apply bg-gray-800 rounded-lg p-6 max-w-4xl mx-auto;}.scoring-header[_ngcontent-%COMP%]{@apply border-b border-gray-700 pb-4 mb-6;}.processing-state[_ngcontent-%COMP%]{@apply text-center py-8;}.processing-animation[_ngcontent-%COMP%]{@apply mb-6;}.kinban-spinner[_ngcontent-%COMP%]{@apply flex justify-center;}.processing-steps[_ngcontent-%COMP%]{@apply flex justify-center gap-8 mb-6 flex-wrap;}.step[_ngcontent-%COMP%]{@apply flex flex-col items-center gap-2 text-gray-400 transition-colors;}.step.completed[_ngcontent-%COMP%]{@apply text-blue-400;}.step[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{@apply text-xl;}.step[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{@apply text-xs;}.progress-bar[_ngcontent-%COMP%]{@apply w-full max-w-md mx-auto bg-gray-700 rounded-full h-2;}.progress-fill[_ngcontent-%COMP%]{@apply bg-blue-400 h-full rounded-full transition-all duration-300;}.score-results[_ngcontent-%COMP%]{@apply space-y-6;}.main-score[_ngcontent-%COMP%]{@apply flex items-center gap-6 p-6 rounded-lg border-l-4;}.main-score.green[_ngcontent-%COMP%]{@apply bg-green-900/30 border-green-400;}.main-score.yellow[_ngcontent-%COMP%]{@apply bg-yellow-900/30 border-yellow-400;}.main-score.orange[_ngcontent-%COMP%]{@apply bg-orange-900/30 border-orange-400;}.main-score.red[_ngcontent-%COMP%]{@apply bg-red-900/30 border-red-400;}.score-circle[_ngcontent-%COMP%]{@apply flex flex-col items-center justify-center w-24 h-24 rounded-full border-4 border-current;}.score-number[_ngcontent-%COMP%]{@apply text-2xl font-bold text-white;}.score-label[_ngcontent-%COMP%]{@apply text-xs text-gray-300;}.score-info[_ngcontent-%COMP%]{@apply flex-1;}.score-level[_ngcontent-%COMP%]{@apply text-xl font-bold text-white mb-1;}.score-status[_ngcontent-%COMP%]{@apply text-gray-300 mb-2;}.risk-indicator[_ngcontent-%COMP%]{@apply flex items-center gap-2 text-sm;}.risk-indicator.low[_ngcontent-%COMP%]{@apply text-green-400;}.risk-indicator.medium[_ngcontent-%COMP%]{@apply text-yellow-400;}.risk-indicator.high[_ngcontent-%COMP%]{@apply text-orange-400;}.risk-indicator.very-high[_ngcontent-%COMP%]{@apply text-red-400;}.factors-breakdown[_ngcontent-%COMP%]{@apply bg-gray-700 rounded-lg p-4;}.factors-grid[_ngcontent-%COMP%]{@apply grid grid-cols-1 sm:grid-cols-2 gap-4;}.factor-item[_ngcontent-%COMP%]{@apply space-y-2;}.factor-header[_ngcontent-%COMP%]{@apply flex items-center gap-2 text-sm text-white;}.factor-score[_ngcontent-%COMP%]{@apply text-lg font-semibold text-white;}.factor-bar[_ngcontent-%COMP%]{@apply w-full bg-gray-600 rounded-full h-2;}.factor-fill[_ngcontent-%COMP%]{@apply bg-blue-400 h-full rounded-full transition-all duration-300;}.recommendations[_ngcontent-%COMP%], .next-steps[_ngcontent-%COMP%]{@apply bg-gray-700 rounded-lg p-4;}.recommendation-list[_ngcontent-%COMP%], .steps-list[_ngcontent-%COMP%]{@apply space-y-2 text-gray-300 text-sm;}.recommendation-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%], .steps-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{@apply flex items-start gap-2;}.recommendation-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:before{@apply content-["\\2022"] text-yellow-400 font-bold;}.steps-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{@apply whitespace-pre-wrap;}.processing-info[_ngcontent-%COMP%]{@apply text-xs text-gray-400 border-t border-gray-700 pt-4;}.info-grid[_ngcontent-%COMP%]{@apply flex justify-center gap-6 flex-wrap;}.info-item[_ngcontent-%COMP%]{@apply flex items-center gap-2;}.action-buttons[_ngcontent-%COMP%]{@apply flex gap-4 justify-center flex-wrap;}.continue-button[_ngcontent-%COMP%]{@apply bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors;}.review-button[_ngcontent-%COMP%]{@apply bg-yellow-600 hover:bg-yellow-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors;}.recalculate-button[_ngcontent-%COMP%]{@apply bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors;}.error-state[_ngcontent-%COMP%]{@apply text-center py-8;}.retry-button[_ngcontent-%COMP%]{@apply bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-colors;}']})};var Jt=(i,t)=>t.id;function Zt(i,t){if(i&1){let e=x();d(0,"button",9),S("click",function(){f(e);let o=p(2);return _(o.setActiveTab("documents"))}),a(1," Documentos "),l()}if(i&2){let e=p(2);R(e.getTabClass("documents"))}}function en(i,t){if(i&1){let e=x();d(0,"button",9),S("click",function(){f(e);let o=p(2);return _(o.setActiveTab("payment"))}),a(1," Pago "),l()}if(i&2){let e=p(2);R(e.getTabClass("payment"))}}function tn(i,t){if(i&1){let e=x();d(0,"button",9),S("click",function(){f(e);let o=p(2);return _(o.setActiveTab("signature"))}),a(1," Firma Digital "),l()}if(i&2){let e=p(2);R(e.getTabClass("signature"))}}function nn(i,t){if(i&1){let e=x();d(0,"button",28),S("click",function(){f(e);let o=p(4);return _(o.toggleMetamapVerification())}),a(1," \u{1F50D} Iniciar Verificaci\xF3n KYC "),l()}}function on(i,t){if(i&1&&(d(0,"div",23)(1,"div",24)(2,"span",25),a(3),l(),d(4,"span",26),a(5),l()(),u(6,nn,2,0,"button",27),l()),i&2){let e=t.$implicit;R("status-"+e.status.toLowerCase().replace(" ","-")),r(3),y(e.name),r(2),y(e.status),r(),g(e.name==="Verificaci\xF3n Biom\xE9trica (Metamap)"&&e.status==="Pendiente"?6:-1)}}function an(i,t){if(i&1){let e=x();d(0,"div",18)(1,"h3"),a(2,"\u{1F50D} Verificaci\xF3n de Identidad (KYC)"),l(),d(3,"p",29),a(4,"Verificaci\xF3n biom\xE9trica obligatoria antes de proceder con la formalizaci\xF3n"),l(),d(5,"app-metamap",30),S("onVerificationComplete",function(o){f(e);let m=p(3);return _(m.onVerificationComplete(o))})("onVerificationStart",function(o){f(e);let m=p(3);return _(m.onVerificationStart(o))})("onVerificationError",function(o){f(e);let m=p(3);return _(m.onVerificationError(o))}),l()()}if(i&2){let e=p(3);r(5),T("clientId",e.client.id)}}function rn(i,t){if(i&1&&(d(0,"div",19)(1,"h3"),a(2,"Plan de Pagos"),l(),d(3,"div",31)(4,"div",32)(5,"label"),a(6,"Meta Mensual:"),l(),d(7,"span"),a(8),l()(),d(9,"div",32)(10,"label"),a(11,"Progreso Actual:"),l(),d(12,"span"),a(13),l()()()()),i&2){let e=p(3);r(8),E("$",e.client.paymentPlan.monthlyGoal.toLocaleString("es-MX")),r(5),E("$",e.client.paymentPlan.currentMonthProgress.toLocaleString("es-MX"))}}function sn(i,t){if(i&1&&(d(0,"div",20)(1,"h3"),a(2,"Plan de Ahorro"),l(),d(3,"div",33)(4,"div",34)(5,"label"),a(6,"Meta:"),l(),d(7,"span"),a(8),l()(),d(9,"div",34)(10,"label"),a(11,"Progreso:"),l(),d(12,"span"),a(13),l()()()()),i&2){let e=p(3);r(8),E("$",e.client.savingsPlan.goal.toLocaleString("es-MX")),r(5),E("$",e.client.savingsPlan.progress.toLocaleString("es-MX"))}}function cn(i,t){i&1&&a(0," \u{1F4B0} Ocultar Opciones de Pago ")}function ln(i,t){i&1&&a(0," \u{1F4B3} Solicitar Pago de Enganche ")}function dn(i,t){if(i&1){let e=x();d(0,"div",37)(1,"app-payment-request",38),S("paymentCompleted",function(o){f(e);let m=p(4);return _(m.onPaymentCompleted(o))})("proceedToSignature",function(){f(e);let o=p(4);return _(o.onProceedToSignature())}),l()()}if(i&2){let e=p(4);r(),T("clientId",e.client.id)("paymentAmount",e.getPaymentAmount())("paymentDescription","Pago de enganche - "+e.client.name)}}function mn(i,t){if(i&1){let e=x();d(0,"div",19)(1,"div",35)(2,"h3"),a(3,"Solicitud de Pago"),l(),d(4,"button",36),S("click",function(){f(e);let o=p(3);return _(o.togglePaymentRequest())}),u(5,cn,1,0)(6,ln,1,0),l()(),u(7,dn,2,3,"div",37),l()}if(i&2){let e=p(3);r(4),K("active",e.showPaymentRequest()),r(),g(e.showPaymentRequest()?5:6),r(2),g(e.showPaymentRequest()?7:-1)}}function pn(i,t){i&1&&a(0," \u{1F4C1} Ocultar Firma Digital ")}function un(i,t){i&1&&a(0," \u270D\uFE0F Gestionar Firma Digital ")}function gn(i,t){if(i&1){let e=x();d(0,"div",41)(1,"app-digital-signature",42),S("documentSigned",function(o){f(e);let m=p(4);return _(m.onDocumentSigned(o))}),l()()}if(i&2){let e=p(4);r(),T("clientId",e.client.id)}}function fn(i,t){if(i&1){let e=x();d(0,"div",21)(1,"div",39)(2,"h3"),a(3,"\u270D\uFE0F Firma Digital de Contratos (Mifiel)"),l(),d(4,"p",29),a(5,"Firma electr\xF3nica de contratos despu\xE9s de completar KYC y pago"),l(),d(6,"button",40),S("click",function(){f(e);let o=p(3);return _(o.toggleDigitalSignature())}),u(7,pn,1,0)(8,un,1,0),l()(),u(9,gn,2,1,"div",41),l()}if(i&2){let e=p(3);r(6),K("active",e.showDigitalSignature()),r(),g(e.showDigitalSignature()?7:8),r(2),g(e.showDigitalSignature()?9:-1)}}function _n(i,t){i&1&&a(0," \u{1F4CA} Ocultar Evaluaci\xF3n ")}function hn(i,t){i&1&&a(0," \u{1F3AF} Realizar Scoring Crediticio ")}function Cn(i,t){if(i&1){let e=x();d(0,"div",45)(1,"app-kinban-scoring",46),S("scoringCompleted",function(o){f(e);let m=p(4);return _(m.onScoringCompleted(o))}),l()()}if(i&2){let e=p(4);r(),T("scoreRequest",e.kinbanScoreRequest())}}function xn(i,t){if(i&1){let e=x();d(0,"div",22)(1,"div",43)(2,"h3"),a(3,"Evaluaci\xF3n Crediticia KINBAN/HASE"),l(),d(4,"button",44),S("click",function(){f(e);let o=p(3);return _(o.toggleKinbanScoring())}),u(5,_n,1,0)(6,hn,1,0),l()(),u(7,Cn,2,1,"div",45),l()}if(i&2){let e=p(3);r(4),K("active",e.showKinbanScoring()),r(),g(e.showKinbanScoring()?5:6),r(2),g(e.showKinbanScoring()?7:-1)}}function bn(i,t){if(i&1&&(d(0,"div",15)(1,"h3"),a(2,"Documentos"),l(),d(3,"div",16),H(4,on,7,5,"div",17,Jt),l()(),u(6,an,6,1,"div",18),u(7,rn,14,2,"div",19),u(8,sn,14,2,"div",20),u(9,mn,8,4,"div",19),u(10,fn,10,4,"div",21),u(11,xn,8,4,"div",22)),i&2){let e=p(2);r(4),B(e.client.documents),r(2),g(e.showMetamap()&&e.hasMetamapDocument()?6:-1),r(),g(e.client.paymentPlan?7:-1),r(),g(e.client.savingsPlan?8:-1),r(),g(e.needsPayment()?9:-1),r(),g(e.needsDigitalSignature()?10:-1),r(),g(e.needsKinbanScoring()?11:-1)}}function vn(i,t){if(i&1){let e=x();d(0,"div",12)(1,"app-document-capture",47),S("documentCaptured",function(o){f(e);let m=p(2);return _(m.onDocumentCaptured(o))})("documentsUpdated",function(){f(e);let o=p(2);return _(o.onDocumentsUpdated())}),l()()}if(i&2){let e=p(2);r(),T("clientId",e.client.id)("clientName",e.client.name)("configuration",e.documentConfiguration())}}function yn(i,t){if(i&1){let e=x();d(0,"div",13)(1,"app-payment-request",38),S("paymentCompleted",function(o){f(e);let m=p(2);return _(m.onPaymentCompleted(o))})("proceedToSignature",function(){f(e);let o=p(2);return _(o.onProceedToSignature())}),l()()}if(i&2){let e=p(2);r(),T("clientId",e.client.id)("paymentAmount",e.getPaymentAmount())("paymentDescription","Pago de enganche - "+e.client.name)}}function Sn(i,t){if(i&1){let e=x();d(0,"div",14)(1,"app-digital-signature",42),S("documentSigned",function(o){f(e);let m=p(2);return _(m.onDocumentSigned(o))}),l()()}if(i&2){let e=p(2);r(),T("clientId",e.client.id)}}function En(i,t){if(i&1){let e=x();d(0,"div",2),D(1,"img",3),d(2,"div",4)(3,"h1"),a(4),l(),d(5,"p",5),a(6),l(),d(7,"p",6),a(8),l()()(),d(9,"div",7)(10,"div",8)(11,"button",9),S("click",function(){f(e);let o=p();return _(o.setActiveTab("overview"))}),a(12," General "),l(),u(13,Zt,2,2,"button",10),u(14,en,2,2,"button",10),u(15,tn,2,2,"button",10),l()(),d(16,"div",11),u(17,bn,12,6),u(18,vn,2,3,"div",12),u(19,yn,2,3,"div",13),u(20,Sn,2,1,"div",14),l()}if(i&2){let e=p();r(),T("src",e.client.avatarUrl,me)("alt",e.client.name),r(3),y(e.client.name),r(2),y(e.client.status),r(2),y(e.client.flow),r(3),R(e.getTabClass("overview")),r(2),g(e.needsDocumentCapture()?13:-1),r(),g(e.needsPayment()?14:-1),r(),g(e.needsDigitalSignature()?15:-1),r(2),g(e.currentTab()==="overview"?17:-1),r(),g(e.currentTab()==="documents"?18:-1),r(),g(e.currentTab()==="payment"?19:-1),r(),g(e.currentTab()==="signature"?20:-1)}}function wn(i,t){i&1&&(d(0,"div",1)(1,"p"),a(2,"No hay cliente seleccionado"),l()())}var qe=class i{client=null;showMetamap=b(!1);showDigitalSignature=b(!1);showPaymentRequest=b(!1);showDocumentCapture=b(!1);showKinbanScoring=b(!1);currentTab=b("overview");scoringResult=b(null);isScoringCompleted=b(!1);documentConfiguration=X(()=>{if(!this.client)return{market:"aguascalientes",product:"venta-directa"};let t="aguascalientes",e;switch(this.client.flow){case"Venta Directa":e="venta-directa";break;case"Venta a Plazo":e="venta-plazo";break;case"Plan de Ahorro":e="ahorro-programado";break;default:e="venta-directa"}let n=this.client.collectiveCreditGroupId?"colectivo":"individual";return{market:t,product:e,clientType:n}});kinbanScoreRequest=X(()=>{if(!this.client)return{clientId:"unknown",personalInfo:{name:"Unknown Client"},businessInfo:{market:"aguascalientes",product:"venta-directa"},documentsInfo:{totalDocuments:0,completedDocuments:0,hasINE:!1,hasProofOfAddress:!1,hasRFC:!1,hasMetamap:!1}};let t=this.documentConfiguration(),e=this.client.documents.filter(n=>n.status==="Aprobado");return{clientId:this.client.id,personalInfo:{name:this.client.name,rfc:this.extractRFCFromDocuments(),email:this.extractEmailFromClient(),phone:this.extractPhoneFromClient()},businessInfo:{market:t.market,product:t.product,requestedAmount:this.client.downPayment||void 0,monthlyIncome:this.estimateMonthlyIncome()},documentsInfo:{totalDocuments:this.client.documents.length,completedDocuments:e.length,hasINE:this.client.documents.some(n=>n.name==="INE Vigente"&&n.status==="Aprobado"),hasProofOfAddress:this.client.documents.some(n=>n.name==="Comprobante de domicilio"&&n.status==="Aprobado"),hasRFC:this.client.documents.some(n=>n.name==="Constancia de situaci\xF3n fiscal"&&n.status==="Aprobado"),hasMetamap:this.client.documents.some(n=>n.name==="Verificaci\xF3n Biom\xE9trica (Metamap)"&&n.status==="Aprobado")}}});toggleMetamapVerification(){this.showMetamap.set(!this.showMetamap())}onVerificationComplete(t){if(console.log("Verification completed:",t),this.client){let e=this.client.documents.find(n=>n.name==="Verificaci\xF3n Biom\xE9trica (Metamap)");e&&(e.status="Aprobado")}}onVerificationStart(t){if(console.log("Verification started:",t),this.client){let e=this.client.documents.find(n=>n.name==="Verificaci\xF3n Biom\xE9trica (Metamap)");e&&(e.status="En Revisi\xF3n")}}onVerificationError(t){if(console.error("Verification error:",t),this.client){let e=this.client.documents.find(n=>n.name==="Verificaci\xF3n Biom\xE9trica (Metamap)");e&&(e.status="Rechazado")}}hasMetamapDocument(){return this.client?.documents.some(t=>t.name==="Verificaci\xF3n Biom\xE9trica (Metamap)")||!1}getMetamapDocumentStatus(){return this.client?.documents.find(e=>e.name==="Verificaci\xF3n Biom\xE9trica (Metamap)")?.status||"Pendiente"}toggleDigitalSignature(){this.showDigitalSignature.set(!this.showDigitalSignature())}onDocumentSigned(t){console.log("Document signed:",t)}needsDigitalSignature(){return this.client?.flow==="Venta a Plazo"||this.client?.flow==="Plan de Ahorro"}needsKinbanScoring(){return this.client?this.client.documents.some(e=>["INE","Comprobante de Domicilio"].includes(e.name)&&e.status==="Aprobado")&&!this.isScoringCompleted():!1}togglePaymentRequest(){this.showPaymentRequest.set(!this.showPaymentRequest())}needsPayment(){return this.client?.status==="Aprobado"||this.client?.status==="Activo"}getPaymentAmount(){return this.client?.paymentPlan?.monthlyGoal?this.client.paymentPlan.monthlyGoal:this.client?.savingsPlan?.goal?this.client.savingsPlan.goal*.2:15e4}onPaymentCompleted(t){console.log("Payment completed:",t),this.client&&(this.client.status="Pago Confirmado"),setTimeout(()=>{this.showDigitalSignature.set(!0),this.showPaymentRequest.set(!1)},2e3)}onProceedToSignature(){this.showDigitalSignature.set(!0),this.showPaymentRequest.set(!1)}toggleDocumentCapture(){this.showDocumentCapture.set(!this.showDocumentCapture())}setActiveTab(t){switch(this.currentTab.set(t),t){case"documents":this.showDocumentCapture.set(!0),this.showKinbanScoring.set(!1),this.showPaymentRequest.set(!1),this.showDigitalSignature.set(!1);break;case"scoring":this.showKinbanScoring.set(!0),this.showDocumentCapture.set(!1),this.showPaymentRequest.set(!1),this.showDigitalSignature.set(!1);break;case"payment":this.showPaymentRequest.set(!0),this.showDocumentCapture.set(!1),this.showKinbanScoring.set(!1),this.showDigitalSignature.set(!1);break;case"signature":this.showDigitalSignature.set(!0),this.showDocumentCapture.set(!1),this.showKinbanScoring.set(!1),this.showPaymentRequest.set(!1);break;default:this.showDocumentCapture.set(!1),this.showKinbanScoring.set(!1),this.showPaymentRequest.set(!1),this.showDigitalSignature.set(!1)}}onDocumentCaptured(t){if(console.log("Document captured:",t),this.client){let e=this.client.documents.find(n=>n.name===t.name);e&&(e.status="En Revisi\xF3n")}this.checkScoringTrigger()}onDocumentsUpdated(){console.log("Documents updated"),this.checkScoringTrigger()}toggleKinbanScoring(){this.showKinbanScoring.set(!this.showKinbanScoring())}needsScoring(){return this.client?this.client.documents.filter(e=>["INE Vigente","Comprobante de domicilio","Constancia de situaci\xF3n fiscal"].includes(e.name)&&e.status==="Aprobado").length>=2&&!this.isScoringCompleted():!1}onScoringCompleted(t){console.log("KINBAN scoring completed:",t),this.scoringResult.set(t),this.isScoringCompleted.set(!0),this.client&&(this.client.healthScore=t.score),t.status==="approved"&&setTimeout(()=>{this.currentTab.set("payment"),this.showKinbanScoring.set(!1)},2e3)}onScoringContinueFlow(){this.currentTab.set("payment"),this.showKinbanScoring.set(!1)}onScoringReviewRequired(t){console.log("Scoring requires review:",t)}checkScoringTrigger(){this.needsScoring()&&!this.showKinbanScoring()&&setTimeout(()=>{this.currentTab.set("scoring"),this.showKinbanScoring.set(!0)},1e3)}extractRFCFromDocuments(){return this.client?.name?this.generateSampleRFC(this.client.name):void 0}generateSampleRFC(t){let e=t.split(" "),n=e[0]?.substring(0,2).toUpperCase()||"XX",o=e[e.length-1]?.substring(0,2).toUpperCase()||"XX",m=Math.floor(Math.random()*9e5)+1e5;return`${n}${o}${m}`}extractEmailFromClient(){if(this.client?.name)return`${this.client.name.toLowerCase().replace(/\s+/g,".")}@example.com`}extractPhoneFromClient(){return`55${Math.floor(Math.random()*9e7)+1e7}`}estimateMonthlyIncome(){if(this.client?.downPayment)return Math.floor(this.client.downPayment/3.5)}onDocumentsRefresh(){console.log("Documents updated - refreshing client view")}needsDocumentCapture(){return this.client?.status==="Expediente Pendiente"||this.client?.status==="En Proceso"||this.client?.status==="Nuevas Oportunidades"}getTabClass(t){return`px-4 py-2 text-sm font-medium rounded-lg transition-colors duration-200 ${this.currentTab()===t?"bg-primary-cyan-600 text-white":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=N({type:i,selectors:[["app-client-detail"]],inputs:{client:"client"},decls:3,vars:1,consts:[[1,"client-detail-container"],[1,"no-client"],[1,"client-header"],[1,"client-avatar",3,"src","alt"],[1,"client-info"],[1,"client-status"],[1,"client-flow"],[1,"tab-navigation","mb-6"],[1,"flex","space-x-2"],["type","button",3,"click"],["type","button",3,"class"],[1,"client-sections"],[1,"document-capture-section"],[1,"payment-section"],[1,"signature-section"],[1,"section","documents-section"],[1,"documents-list"],[1,"document-item",3,"class"],[1,"section","kyc-verification-section"],[1,"section","payment-section"],[1,"section","savings-section"],[1,"section","signature-section"],[1,"section","scoring-section"],[1,"document-item"],[1,"document-info"],[1,"document-name"],[1,"document-status"],[1,"verification-btn","kyc-btn"],[1,"verification-btn","kyc-btn",3,"click"],[1,"section-description"],[3,"onVerificationComplete","onVerificationStart","onVerificationError","clientId"],[1,"payment-details"],[1,"payment-stat"],[1,"savings-details"],[1,"savings-stat"],[1,"payment-header"],[1,"payment-toggle-btn",3,"click"],[1,"payment-content"],[3,"paymentCompleted","proceedToSignature","clientId","paymentAmount","paymentDescription"],[1,"signature-header"],[1,"signature-toggle-btn",3,"click"],[1,"signature-content"],[3,"documentSigned","clientId"],[1,"scoring-header"],[1,"scoring-toggle-btn",3,"click"],[1,"scoring-content"],[3,"scoringCompleted","scoreRequest"],[3,"documentCaptured","documentsUpdated","clientId","clientName","configuration"]],template:function(e,n){e&1&&(d(0,"div",0),u(1,En,21,14)(2,wn,3,0,"div",1),l()),e&2&&(r(),g(n.client?1:2))},dependencies:[q,ue,_e,Ce,ve,Se],styles:[".client-detail-container[_ngcontent-%COMP%]{padding:2rem;background-color:#030712;min-height:100vh;color:#e5e7eb}.client-detail-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:2rem;font-weight:700;color:#fff;margin:0 0 .5rem}.client-detail-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#9ca3af;margin:0 0 2rem}.placeholder-content[_ngcontent-%COMP%]{text-align:center;padding:3rem 2rem;background:linear-gradient(135deg,#1f2937,#374151);border-radius:12px;border:1px solid #374151}.placeholder-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#9ca3af;font-size:1.1rem;margin:0}.client-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;margin-bottom:2rem}.client-header[_ngcontent-%COMP%]   .client-avatar[_ngcontent-%COMP%]{width:64px;height:64px;border-radius:50%;object-fit:cover}.client-header[_ngcontent-%COMP%]   .client-info[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:#fff;margin:0}.client-header[_ngcontent-%COMP%]   .client-status[_ngcontent-%COMP%], .client-header[_ngcontent-%COMP%]   .client-flow[_ngcontent-%COMP%]{color:#9ca3af;margin:.25rem 0 0}.client-sections[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem}.section[_ngcontent-%COMP%]{background:linear-gradient(135deg,#1f2937,#374151);border-radius:12px;border:1px solid #374151;padding:1.5rem}.section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;color:#fff;margin:0 0 1rem}.documents-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem}.document-item[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:.75rem;background:#374151;border-radius:8px}.document-item[_ngcontent-%COMP%]   .document-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.document-item[_ngcontent-%COMP%]   .document-info[_ngcontent-%COMP%]   .document-name[_ngcontent-%COMP%]{color:#fff;font-weight:500}.document-item[_ngcontent-%COMP%]   .document-info[_ngcontent-%COMP%]   .document-status[_ngcontent-%COMP%]{color:#9ca3af;font-size:.875rem}.document-item[_ngcontent-%COMP%]   .verification-btn[_ngcontent-%COMP%]{padding:.5rem 1rem;background:#0891b2;color:#fff;border:none;border-radius:6px;cursor:pointer;font-size:.875rem}.document-item[_ngcontent-%COMP%]   .verification-btn[_ngcontent-%COMP%]:hover{background:#0e7490}.payment-details[_ngcontent-%COMP%], .savings-details[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem}.payment-stat[_ngcontent-%COMP%], .savings-stat[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.payment-stat[_ngcontent-%COMP%]   label[_ngcontent-%COMP%], .savings-stat[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{color:#9ca3af;font-size:.875rem;font-weight:500}.payment-stat[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .savings-stat[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#fff;font-size:1.25rem;font-weight:600}.payment-section[_ngcontent-%COMP%]   .payment-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;margin-bottom:1rem}.payment-section[_ngcontent-%COMP%]   .payment-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0}.payment-section[_ngcontent-%COMP%]   .payment-header[_ngcontent-%COMP%]   .payment-toggle-btn[_ngcontent-%COMP%]{padding:.75rem 1.5rem;background:linear-gradient(135deg,#10b981,#059669);color:#fff;border:none;border-radius:8px;cursor:pointer;font-size:.875rem;font-weight:600;transition:all .3s ease;box-shadow:0 4px 6px #10b9814d}.payment-section[_ngcontent-%COMP%]   .payment-header[_ngcontent-%COMP%]   .payment-toggle-btn[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,#059669,#047857);transform:translateY(-1px);box-shadow:0 6px 12px #10b98166}.payment-section[_ngcontent-%COMP%]   .payment-header[_ngcontent-%COMP%]   .payment-toggle-btn.active[_ngcontent-%COMP%]{background:linear-gradient(135deg,#dc2626,#b91c1c);box-shadow:0 4px 6px #dc26264d}.payment-section[_ngcontent-%COMP%]   .payment-header[_ngcontent-%COMP%]   .payment-toggle-btn.active[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,#b91c1c,#991b1b);box-shadow:0 6px 12px #dc262666}.payment-section[_ngcontent-%COMP%]   .payment-content[_ngcontent-%COMP%]{margin-top:1rem;padding:1.5rem;background:#1f2937;border-radius:12px;border:1px solid #374151;box-shadow:0 4px 6px #0000001a}.signature-section[_ngcontent-%COMP%]   .signature-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;margin-bottom:1rem}.signature-section[_ngcontent-%COMP%]   .signature-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0}.signature-section[_ngcontent-%COMP%]   .signature-header[_ngcontent-%COMP%]   .signature-toggle-btn[_ngcontent-%COMP%]{padding:.75rem 1rem;background:#0891b2;color:#fff;border:none;border-radius:8px;cursor:pointer;font-size:.875rem;font-weight:500;transition:background-color .2s}.signature-section[_ngcontent-%COMP%]   .signature-header[_ngcontent-%COMP%]   .signature-toggle-btn[_ngcontent-%COMP%]:hover{background:#0e7490}.signature-section[_ngcontent-%COMP%]   .signature-header[_ngcontent-%COMP%]   .signature-toggle-btn.active[_ngcontent-%COMP%]{background:#dc2626}.signature-section[_ngcontent-%COMP%]   .signature-header[_ngcontent-%COMP%]   .signature-toggle-btn.active[_ngcontent-%COMP%]:hover{background:#b91c1c}.signature-section[_ngcontent-%COMP%]   .signature-content[_ngcontent-%COMP%]{margin-top:1rem;padding:1rem;background:#1f2937;border-radius:8px;border:1px solid #374151}.no-client[_ngcontent-%COMP%]{text-align:center;padding:3rem 2rem}.no-client[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#9ca3af;font-size:1.1rem;margin:0}"]})};export{qe as ClientDetailComponent};
