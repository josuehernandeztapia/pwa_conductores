import{A as u,N as p,j as m}from"./chunk-IDEEAVYW.js";import{a as o,b as r}from"./chunk-EQDQRRRY.js";var v=class d{clientsDB=new Map;collectiveCreditGroupsDB=new Map;ecosystemsDB=new Map;notificationId=0;CONTADO_DOCS=[{id:"1",name:"INE Vigente",status:"Pendiente"},{id:"2",name:"Comprobante de domicilio",status:"Pendiente"},{id:"3",name:"Constancia de situaci\xF3n fiscal",status:"Pendiente"}];AGUASCALIENTES_FINANCIERO_DOCS=[{id:"1",name:"INE Vigente",status:"Pendiente"},{id:"2",name:"Comprobante de domicilio",status:"Pendiente"},{id:"3",name:"Tarjeta de circulaci\xF3n",status:"Pendiente"},{id:"4",name:"Copia de la concesi\xF3n",status:"Pendiente"},{id:"5",name:"Constancia de situaci\xF3n fiscal",status:"Pendiente"},{id:"6",name:"Verificaci\xF3n Biom\xE9trica (Metamap)",status:"Pendiente"}];EDOMEX_MIEMBRO_DOCS=[...this.AGUASCALIENTES_FINANCIERO_DOCS,{id:"7",name:"Carta Aval de Ruta",status:"Pendiente",tooltip:"Documento emitido y validado por el Ecosistema/Ruta."},{id:"8",name:"Convenio de Daci\xF3n en Pago",status:"Pendiente",tooltip:"Convenio que formaliza el colateral social."}];EDOMEX_AHORRO_DOCS=[{id:"1",name:"INE Vigente",status:"Pendiente"},{id:"2",name:"Comprobante de domicilio",status:"Pendiente"}];constructor(){this.initializeDB()}mockApi(a,t=500){return m(JSON.parse(JSON.stringify(a))).pipe(u(t))}addDerivedGroupProperties(a){let t=a.unitsDelivered<a.totalUnits,e=a.unitsDelivered>0,i="saving";return t&&e?i="dual":(e&&!t||a.unitsDelivered===a.totalUnits)&&(i="payment"),r(o({},a),{phase:i,savingsGoal:a.savingsGoalPerUnit,currentSavings:a.currentSavingsProgress,monthlyPaymentGoal:a.monthlyPaymentPerUnit*a.unitsDelivered})}createMembers(a){return a.map(t=>({clientId:t.id,name:t.name,avatarUrl:t.avatarUrl,status:"active",individualContribution:t.events.filter(e=>e.type==="Contribution"&&e.details?.amount).reduce((e,i)=>e+(i.details?.amount||0),0)}))}getFilteredClients(a){let t=Array.from(this.clientsDB.values());return a==="aguascalientes"?t.filter(e=>!e.ecosystemId):a==="edomex"?t.filter(e=>!!e.ecosystemId):t}initializeDB(){let a=[{id:"eco-1",name:"Ruta 27 de Toluca S.A. de C.V.",status:"Activo",documents:[{id:"eco-1-doc-1",name:"Acta Constitutiva de la Ruta",status:"Aprobado"},{id:"eco-1-doc-2",name:"Poder del Representante Legal",status:"Aprobado"}]},{id:"eco-2",name:"Autotransportes de Tlalnepantla",status:"Expediente Pendiente",documents:[{id:"eco-2-doc-1",name:"Acta Constitutiva de la Ruta",status:"Pendiente"}]}],t=[{id:"1",name:"Juan P\xE9rez (Venta a Plazo AGS)",avatarUrl:"https://picsum.photos/seed/juan/100/100",flow:"Venta a Plazo",status:"Activo",healthScore:85,paymentPlan:{monthlyGoal:18282.88,currentMonthProgress:6e3,currency:"MXN",methods:{collection:!0,voluntary:!0},collectionDetails:{plates:["XYZ-123-A"],pricePerLiter:5}},documents:this.AGUASCALIENTES_FINANCIERO_DOCS.map((e,i)=>r(o({},e),{status:i<2?"Aprobado":"Pendiente"})),events:[{id:"evt1-3",timestamp:new Date,message:"Aportaci\xF3n Voluntaria confirmada.",actor:"Sistema",type:"Contribution",details:{amount:5e3,currency:"MXN"}},{id:"evt1-4",timestamp:new Date(Date.now()-.5*24*60*60*1e3),message:"Recaudaci\xF3n Flota (Placa XYZ-123-A).",actor:"Sistema",type:"Collection",details:{amount:1e3,currency:"MXN",plate:"XYZ-123-A"}},{id:"evt1-2",timestamp:new Date(Date.now()-1440*60*1e3),message:"Documento INE/IFE cargado.",actor:"Cliente",type:"ClientAction"},{id:"evt1-1",timestamp:new Date(Date.now()-2880*60*1e3),message:"Plan de Venta a Plazo creado.",actor:"Asesor",type:"AdvisorAction"}]}];this.clientsDB.clear(),this.collectiveCreditGroupsDB.clear(),this.ecosystemsDB.clear(),t.forEach(e=>this.clientsDB.set(e.id,e)),a.forEach(e=>this.ecosystemsDB.set(e.id,e))}getClients(){return this.mockApi(Array.from(this.clientsDB.values()),1e3)}getCollectiveCreditGroups(){let t=Array.from(this.collectiveCreditGroupsDB.values()).map(e=>{let i=o({},e),s=i.members.map(l=>this.clientsDB.get(l.clientId)).filter(Boolean),n=this.createMembers(s);return i.members=n,i.unitsDelivered===0&&(i.currentSavingsProgress=n.reduce((l,c)=>l+c.individualContribution,0)),this.addDerivedGroupProperties(i)});return this.mockApi(t,800)}getEcosystems(){return this.mockApi(Array.from(this.ecosystemsDB.values()),700)}createClientFromOnboarding(a){let t=`onboard-${Date.now()}`,e=[],i;a.saleType==="contado"?(i="Venta Directa",e=this.CONTADO_DOCS.map(n=>r(o({},n),{id:`${t}-${n.id}`}))):(i="Venta a Plazo",a.market==="aguascalientes"?e=this.AGUASCALIENTES_FINANCIERO_DOCS.map(n=>r(o({},n),{id:`${t}-${n.id}`})):e=this.EDOMEX_MIEMBRO_DOCS.map(n=>r(o({},n),{id:`${t}-${n.id}`})));let s={id:t,name:a.name,avatarUrl:`https://picsum.photos/seed/${t}/100/100`,flow:i,status:"Nuevas Oportunidades",healthScore:70,documents:e,events:[{id:`${t}-evt-1`,timestamp:new Date,message:`Oportunidad creada desde el flujo de ${a.market}.`,actor:"Asesor",type:"AdvisorAction"}],ecosystemId:a.ecosystemId};return this.clientsDB.set(t,s),this.mockApi(s)}saveQuoteToClient(a,t){let e=this.clientsDB.get(a);if(!e)throw new Error("Client not found");e.flow=t.flow,e.status="Expediente en Proceso",t.flow==="Plan de Ahorro"?(e.savingsPlan={progress:0,goal:t.downPayment,currency:"MXN",totalValue:t.totalPrice,methods:{collection:!1,voluntary:!0}},e.paymentPlan=void 0):(t.flow==="Venta a Plazo"||t.flow==="Venta Directa")&&(e.paymentPlan={monthlyGoal:t.monthlyPayment,currentMonthProgress:0,currency:"MXN",methods:{collection:!1,voluntary:!0}},e.savingsPlan=void 0,e.downPayment=t.downPayment,e.remainderAmount=t.amountToFinance);let i={id:`evt-${a}-${Date.now()}`,timestamp:new Date,message:`Plan de ${t.flow} formalizado con un valor de ${new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(t.totalPrice)}.`,actor:"Asesor",type:"AdvisorAction"};return e.events=[i,...e.events],this.clientsDB.set(a,e),this.mockApi(e)}getOpportunityStages(a="all"){let t=this.getFilteredClients(a),e=[{name:"Nuevas Oportunidades",clientIds:[],count:0},{name:"Expediente en Proceso",clientIds:[],count:0},{name:"Aprobado",clientIds:[],count:0},{name:"Activo",clientIds:[],count:0},{name:"Completado",clientIds:[],count:0}];return t.forEach(i=>{i.status==="Nuevas Oportunidades"?e[0].clientIds.push(i.id):i.status==="Expediente en Proceso"?e[1].clientIds.push(i.id):i.status==="Aprobado"?e[2].clientIds.push(i.id):["Activo","Pagos al Corriente","Activo en Grupo","Esperando Sorteo"].includes(i.status)?e[3].clientIds.push(i.id):["Meta Alcanzada","Turno Adjudicado","Completado","Unidad Lista para Entrega"].includes(i.status)&&e[4].clientIds.push(i.id)}),e.forEach(i=>i.count=i.clientIds.length),this.mockApi(e,900)}getSimulatedAlert(a){if(a.length===0)return this.mockApi(null);let t=a[Math.floor(Math.random()*a.length)],e=[{type:"lead",message:`Nuevo Lead Asignado: ${t.name}`,clientId:t.id},{type:"milestone",message:`\xA1Contrato Firmado! ${t.name} ha firmado.`,clientId:t.id},{type:"risk",message:`Seguimiento Requerido: ${t.name} lleva 3 d\xEDas en 'Expediente en Proceso'.`,clientId:t.id},{type:"system",message:"Actualizaci\xF3n del sistema programada para medianoche."}],i=a.find(c=>c.status==="Meta Alcanzada");i&&e.push({type:"milestone",message:`\xA1Meta Alcanzada! ${i.name} est\xE1 listo para convertir.`,clientId:i.id,action:{text:"Iniciar Conversi\xF3n",type:"convert"}});let s=a.find(c=>c.status==="Aprobado");s&&e.push({type:"milestone",message:`Cr\xE9dito Aprobado para ${s.name}.`,clientId:s.id,action:{text:"Configurar Plan",type:"configure_plan"}});let n=e[Math.floor(Math.random()*e.length)],l=o({id:this.notificationId++,timestamp:new Date},n);return this.mockApi(l,200)}getSidebarAlertCounts(a){let t={oportunidades:a.filter(e=>e.status==="Nuevas Oportunidades").length,clientes:a.filter(e=>["Expediente en Proceso","Aprobado","Meta Alcanzada"].includes(e.status)).length};return this.mockApi(t,150)}getProductPackage(a){return m({"aguascalientes-plazo":{id:"aguascalientes-plazo",name:"Venta a Plazo - Aguascalientes",rate:.15,terms:[12,18,24,36],components:[{id:"1",name:"Veh\xEDculo Base",price:28e4,isOptional:!1},{id:"2",name:"Seguro Anual",price:18e3,isOptional:!1,isMultipliedByTerm:!0},{id:"3",name:"GPS/Rastreo",price:8e3,isOptional:!0},{id:"4",name:"Mantenimiento Preventivo",price:12e3,isOptional:!0,isMultipliedByTerm:!0}],minDownPaymentPercentage:.2},"aguascalientes-directa":{id:"aguascalientes-directa",name:"Venta Directa - Aguascalientes",rate:0,terms:[1],components:[{id:"1",name:"Veh\xEDculo Base",price:28e4,isOptional:!1},{id:"2",name:"GPS/Rastreo",price:8e3,isOptional:!0},{id:"3",name:"Kit de Herramientas",price:15e3,isOptional:!0}],minDownPaymentPercentage:.3},"edomex-plazo":{id:"edomex-plazo",name:"Venta a Plazo - Estado de M\xE9xico",rate:.18,terms:[12,18,24,36,48],components:[{id:"1",name:"Veh\xEDculo Base",price:32e4,isOptional:!1},{id:"2",name:"Seguro Anual",price:22e3,isOptional:!1,isMultipliedByTerm:!0},{id:"3",name:"GPS/Rastreo Avanzado",price:12e3,isOptional:!1},{id:"4",name:"Mantenimiento Preventivo",price:15e3,isOptional:!0,isMultipliedByTerm:!0},{id:"5",name:"Kit Emergencia",price:8e3,isOptional:!0}],minDownPaymentPercentage:.25},"edomex-directa":{id:"edomex-directa",name:"Venta Directa - Estado de M\xE9xico",rate:0,terms:[1],components:[{id:"1",name:"Veh\xEDculo Base",price:32e4,isOptional:!1},{id:"2",name:"GPS/Rastreo Avanzado",price:12e3,isOptional:!1},{id:"3",name:"Kit Emergencia",price:8e3,isOptional:!0},{id:"4",name:"Curso de Manejo Defensivo",price:5e3,isOptional:!0}],minDownPaymentPercentage:.4},"edomex-colectivo":{id:"edomex-colectivo",name:"Cr\xE9dito Colectivo - Estado de M\xE9xico (Tanda)",rate:.12,terms:[24,36,48,60],components:[{id:"1",name:"Veh\xEDculo Base",price:32e4,isOptional:!1},{id:"2",name:"Seguro Grupal",price:18e3,isOptional:!1,isMultipliedByTerm:!0},{id:"3",name:"GPS/Rastreo Grupal",price:1e4,isOptional:!1},{id:"4",name:"Fondo de Contingencia",price:25e3,isOptional:!1},{id:"5",name:"Capacitaci\xF3n Grupal",price:15e3,isOptional:!0}],minDownPaymentPercentage:.15,defaultMembers:5}}[a]||null).pipe(u(800))}static \u0275fac=function(t){return new(t||d)};static \u0275prov=p({token:d,factory:d.\u0275fac,providedIn:"root"})};export{v as a};
