import{a as re}from"./chunk-KIPHH6M7.js";import{a as X,c as oe,e as ne}from"./chunk-SO3QS7QP.js";import{c as ee,d as te}from"./chunk-VKLMJP2F.js";import"./chunk-BYXBJQAS.js";import{$a as D,Ab as J,Ba as M,Fb as Q,H as v,I as b,Ia as G,K as l,L,Ma as H,N as A,Oa as R,Q as j,R as N,S as C,Sa as K,T as W,Ta as Z,Tb as P,Za as y,_a as O,aa as V,ab as q,bb as Y,c as S,f as m,fa as B,ga as u,n as d,ob as T,t as U,ta as $,u as p,v as _,xa as z,z as h}from"./chunk-IDEEAVYW.js";import{a as F}from"./chunk-EQDQRRRY.js";var ie=[{path:"",redirectTo:"/dashboard",pathMatch:"full"},{path:"dashboard",loadComponent:()=>import("./chunk-2VG4G46Q.js").then(e=>e.DashboardComponent)},{path:"simulador",loadComponent:()=>import("./chunk-FI2FYZMH.js").then(e=>e.SimuladorComponent)},{path:"oportunidades",loadComponent:()=>import("./chunk-AFTAQQPM.js").then(e=>e.OportunidadesComponent)},{path:"ecosistemas",loadComponent:()=>import("./chunk-XP5SDB7Y.js").then(e=>e.EcosistemasComponent)},{path:"clientes",loadComponent:()=>import("./chunk-A2W7UKZR.js").then(e=>e.ClientesComponent)},{path:"clientes/:id",loadComponent:()=>import("./chunk-QS6NN5YE.js").then(e=>e.ClientDetailComponent)},{path:"grupos-colectivos",loadComponent:()=>import("./chunk-KGDOWAPB.js").then(e=>e.GruposColectivosComponent)},{path:"configuracion",loadComponent:()=>import("./chunk-6TED7F3R.js").then(e=>e.ConfiguracionComponent)},{path:"ahorro-mode",loadComponent:()=>import("./chunk-3E6OZYTF.js").then(e=>e.AhorroModeComponent)},{path:"cotizador-mode",loadComponent:()=>import("./chunk-IP5HHTI7.js").then(e=>e.CotizadorModeComponent)},{path:"proteccion-simulator",loadComponent:()=>import("./chunk-NGGOSRB2.js").then(e=>e.ProteccionSimulatorComponent)},{path:"proteccion-simulator/:clientId",loadComponent:()=>import("./chunk-NGGOSRB2.js").then(e=>e.ProteccionSimulatorComponent)},{path:"**",redirectTo:"/dashboard"}];var k="Service workers are disabled or not supported by this browser",f=class{serviceWorker;worker;registration;events;constructor(o,t){if(this.serviceWorker=o,!o)this.worker=this.events=this.registration=new S(r=>r.error(new l(5601,!1)));else{let r=null,n=new m;this.worker=new S(a=>(r!==null&&a.next(r),n.subscribe(E=>a.next(E))));let s=()=>{let{controller:a}=o;a!==null&&(r=a,n.next(r))};o.addEventListener("controllerchange",s),s(),this.registration=this.worker.pipe(v(()=>o.getRegistration().then(a=>{if(!a)throw new l(5601,!1);return a})));let i=new m;this.events=i.asObservable();let c=a=>{let{data:E}=a;E?.type&&i.next(E)};o.addEventListener("message",c),t?.get(R,null,{optional:!0})?.onDestroy(()=>{o.removeEventListener("controllerchange",s),o.removeEventListener("message",c)})}}postMessage(o,t){return new Promise(r=>{this.worker.pipe(h(1)).subscribe(n=>{n.postMessage(F({action:o},t)),r()})})}postMessageWithOperation(o,t,r){let n=this.waitForOperationCompleted(r),s=this.postMessage(o,t);return Promise.all([s,n]).then(([,i])=>i)}generateNonce(){return Math.round(Math.random()*1e7)}eventsOfType(o){let t;return typeof o=="string"?t=r=>r.type===o:t=r=>o.includes(r.type),this.events.pipe(_(t))}nextEventOfType(o){return this.eventsOfType(o).pipe(h(1))}waitForOperationCompleted(o){return new Promise((t,r)=>{this.eventsOfType("OPERATION_COMPLETED").pipe(_(n=>n.nonce===o),h(1),d(n=>{if(n.result!==void 0)return n.result;throw new Error(n.error)})).subscribe({next:t,error:r})})}get isEnabled(){return!!this.serviceWorker}},le=(()=>{class e{sw;messages;notificationClicks;notificationCloses;pushSubscriptionChanges;subscription;get isEnabled(){return this.sw.isEnabled}pushManager=null;subscriptionChanges=new m;constructor(t){if(this.sw=t,!t.isEnabled){this.messages=p,this.notificationClicks=p,this.notificationCloses=p,this.pushSubscriptionChanges=p,this.subscription=p;return}this.messages=this.sw.eventsOfType("PUSH").pipe(d(n=>n.data)),this.notificationClicks=this.sw.eventsOfType("NOTIFICATION_CLICK").pipe(d(n=>n.data)),this.notificationCloses=this.sw.eventsOfType("NOTIFICATION_CLOSE").pipe(d(n=>n.data)),this.pushSubscriptionChanges=this.sw.eventsOfType("PUSH_SUBSCRIPTION_CHANGE").pipe(d(n=>n.data)),this.pushManager=this.sw.registration.pipe(d(n=>n.pushManager));let r=this.pushManager.pipe(v(n=>n.getSubscription()));this.subscription=new S(n=>{let s=r.subscribe(n),i=this.subscriptionChanges.subscribe(n);return()=>{s.unsubscribe(),i.unsubscribe()}})}requestSubscription(t){if(!this.sw.isEnabled||this.pushManager===null)return Promise.reject(new Error(k));let r={userVisibleOnly:!0},n=this.decodeBase64(t.serverPublicKey.replace(/_/g,"/").replace(/-/g,"+")),s=new Uint8Array(new ArrayBuffer(n.length));for(let i=0;i<n.length;i++)s[i]=n.charCodeAt(i);return r.applicationServerKey=s,new Promise((i,c)=>{this.pushManager.pipe(v(g=>g.subscribe(r)),h(1)).subscribe({next:g=>{this.subscriptionChanges.next(g),i(g)},error:c})})}unsubscribe(){if(!this.sw.isEnabled)return Promise.reject(new Error(k));let t=r=>{if(r===null)throw new l(5602,!1);return r.unsubscribe().then(n=>{if(!n)throw new l(5603,!1);this.subscriptionChanges.next(null)})};return new Promise((r,n)=>{this.subscription.pipe(h(1),v(t)).subscribe({next:r,error:n})})}decodeBase64(t){return atob(t)}static \u0275fac=function(r){return new(r||e)(N(f))};static \u0275prov=A({token:e,factory:e.\u0275fac})}return e})(),ue=(()=>{class e{sw;versionUpdates;unrecoverable;get isEnabled(){return this.sw.isEnabled}ongoingCheckForUpdate=null;constructor(t){if(this.sw=t,!t.isEnabled){this.versionUpdates=p,this.unrecoverable=p;return}this.versionUpdates=this.sw.eventsOfType(["VERSION_DETECTED","VERSION_INSTALLATION_FAILED","VERSION_READY","NO_NEW_VERSION_DETECTED","VERSION_FAILED"]),this.unrecoverable=this.sw.eventsOfType("UNRECOVERABLE_STATE")}checkForUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(k));if(this.ongoingCheckForUpdate)return this.ongoingCheckForUpdate;let t=this.sw.generateNonce();return this.ongoingCheckForUpdate=this.sw.postMessageWithOperation("CHECK_FOR_UPDATES",{nonce:t},t).finally(()=>{this.ongoingCheckForUpdate=null}),this.ongoingCheckForUpdate}activateUpdate(){if(!this.sw.isEnabled)return Promise.reject(new l(5601,!1));let t=this.sw.generateNonce();return this.sw.postMessageWithOperation("ACTIVATE_UPDATE",{nonce:t},t)}static \u0275fac=function(r){return new(r||e)(N(f))};static \u0275prov=A({token:e,factory:e.\u0275fac})}return e})();var pe=new j("");function me(){let e=C(w);if(!("serviceWorker"in navigator&&e.enabled!==!1))return;let o=C(pe),t=C(G),r=C(R);t.runOutsideAngular(()=>{let n=navigator.serviceWorker,s=()=>n.controller?.postMessage({action:"INITIALIZE"});n.addEventListener("controllerchange",s),r.onDestroy(()=>{n.removeEventListener("controllerchange",s)})}),t.runOutsideAngular(()=>{let n,{registrationStrategy:s}=e;if(typeof s=="function")n=new Promise(i=>s().subscribe(()=>i()));else{let[i,...c]=(s||"registerWhenStable:30000").split(":");switch(i){case"registerImmediately":n=Promise.resolve();break;case"registerWithDelay":n=se(+c[0]||0);break;case"registerWhenStable":n=Promise.race([r.whenStable(),se(+c[0])]);break;default:throw new l(5600,!1)}}n.then(()=>{r.destroyed||navigator.serviceWorker.register(o,{scope:e.scope,updateViaCache:e.updateViaCache,type:e.type}).catch(i=>console.error(L(5604,!1)))})})}function se(e){return new Promise(o=>setTimeout(o,e))}function he(e,o){return new f(e.enabled!==!1?navigator.serviceWorker:void 0,o)}var w=class{enabled;updateViaCache;type;scope;registrationStrategy};function ce(e,o={}){return W([le,ue,{provide:pe,useValue:e},{provide:w,useValue:o},{provide:f,useFactory:he,deps:[w,V]},H(me)])}var de={providers:[B(),J({eventCoalescing:!0}),ne(ie),ee(te()),ce("ngsw-worker.js",{enabled:!Q(),registrationStrategy:"registerWhenStable:30000"})]};var x=class e{static \u0275fac=function(t){return new(t||e)};static \u0275cmp=M({type:e,selectors:[["app-footer"]],decls:5,vars:0,consts:[[1,"bg-gray-900","border-t","border-gray-700","py-4","px-4","md:px-8"],[1,"max-w-7xl","mx-auto"],[1,"text-center"],[1,"text-sm","text-gray-400"]],template:function(t,r){t&1&&(q(0,"footer",0)(1,"div",1)(2,"div",2)(3,"p",3),T(4," \xA9 2025 Conductores del Mundo SAPI de CV. Todos los derechos reservados. "),Y()()()())},dependencies:[P],styles:["footer[_ngcontent-%COMP%]{margin-top:auto}"]})};function ge(e,o){e&1&&(y(0,"div",1)(1,"div",3),D(2,"div",4),y(3,"p"),T(4,"Cargando..."),O()()())}function ve(e,o){e&1&&(y(0,"main",2),D(1,"router-outlet"),O())}var I=class e{constructor(o){this.simulationService=o}destroy$=new m;title=u("Conductores del Mundo - Asesor PWA");clients=u([]);notifications=u([]);unreadCount=u(0);sidebarAlerts=u({});isLoading=u(!0);ngOnInit(){this.loadClients(),this.setupNotificationPolling()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}loadClients(){this.simulationService.getClients().pipe(b(this.destroy$)).subscribe({next:o=>{this.clients.set(o),this.calculateSidebarAlerts(o),this.isLoading.set(!1)},error:o=>{console.error("Failed to fetch clients:",o),this.isLoading.set(!1)}})}setupNotificationPolling(){U(8e3).pipe(b(this.destroy$)).subscribe(()=>{this.simulationService.getSimulatedAlert(this.clients()).pipe(b(this.destroy$)).subscribe({next:o=>{o&&(this.notifications.update(t=>[o,...t]),this.unreadCount.update(t=>t+1))},error:o=>{console.error("Failed to fetch simulated alert:",o)}})})}calculateSidebarAlerts(o){o.length>0&&this.simulationService.getSidebarAlertCounts(o).pipe(b(this.destroy$)).subscribe({next:t=>{this.sidebarAlerts.set(t)},error:t=>{console.error("Failed to get sidebar alert counts:",t)}})}static \u0275fac=function(t){return new(t||e)(z(re))};static \u0275cmp=M({type:e,selectors:[["app-root"]],decls:4,vars:1,consts:[[1,"app-container","min-h-screen","flex","flex-col"],[1,"loading-screen","flex-1","flex","items-center","justify-center"],[1,"flex-1"],[1,"text-center"],[1,"spinner","mx-auto","mb-4"]],template:function(t,r){t&1&&(y(0,"div",0),K(1,ge,5,0,"div",1)(2,ve,2,0,"main",2),D(3,"app-footer"),O()),t&2&&($(),Z(r.isLoading()?1:2))},dependencies:[oe,P,x],styles:[".app-container[_ngcontent-%COMP%]{height:100vh;width:100vw;background-color:#030712;color:#e5e7eb;font-family:system-ui,-apple-system,sans-serif}.loading-screen[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;background-color:#030712;color:#06b6d4}.spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:3px solid #374151;border-top:3px solid #06b6d4;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:16px}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.loading-screen[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:18px;font-weight:500}"]})};X(I,de).catch(e=>console.error(e));
