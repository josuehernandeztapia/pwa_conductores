import{a as X,b as Z,c as $,d as ee,f as te,g as ne,h as ie,i as oe,l as re}from"./chunk-CTNMEYGD.js";import{b as J,d as Q}from"./chunk-SO3QS7QP.js";import"./chunk-VKLMJP2F.js";import{Ba as j,Fa as V,N as z,Nb as L,Ob as Y,Qb as U,Rb as q,Sb as G,Tb as H,X as g,Y as _,Ya as I,Za as o,_a as r,db as O,fb as w,hb as d,j as k,mb as F,ob as a,pb as R,qb as f,rb as K,sb as S,ta as l,tb as h,ub as b,wb as y,xa as B,xb as D,yb as N}from"./chunk-IDEEAVYW.js";import"./chunk-EQDQRRRY.js";var A=class c{constructor(){}simulateProtection(s){let{contrato:e,opciones:n}=s,t=[],i=this.calculateOutstandingBalance(e),u=this.simulateDiferimiento(e,n.diferimiento,i);t.push(u);let m=this.simulateRecalendario(e,n.recalendario,i);t.push(m);let p=this.simulateStepDown(e,n.stepDown,i);t.push(p);let x={type:"Rescate Colectivo",newMonthlyPayment:0,newTerm:0,totalCostDelta:-i*.8,tirPost:0,tirOK:!0,warnings:["Sujeto a aprobaci\xF3n del fondo colectivo"]};return t.push(x),k({escenarios:t})}applyProtection(s,e){return k({status:"success",message:`Protecci\xF3n ${e.type} aplicada para cliente ${s}`,adendumUrl:"https://example.com/adendum"})}calculateOutstandingBalance(s){let{P0:e,r:n,n:t,k:i}=s;if(i===0)return e;let u=Math.pow(1+n,t),m=e*(n*u)/(u-1),p=Math.pow(1+n,i);return e*p-m*((p-1)/n)}simulateDiferimiento(s,e,n){let{r:t,n:i,k:u}=s,{d:m,capitalizaInteres:p}=e,x=n;p&&(x=n*Math.pow(1+t,m));let C=i-u,P=Math.pow(1+t,C),v=x*(t*P)/(P-1),E=p?x-n:0;return{type:"Diferimiento",newMonthlyPayment:v,newTerm:i,totalCostDelta:E,tirPost:t*12,tirOK:t*12<.35,warnings:p?["Intereses capitalizados"]:[]}}simulateRecalendario(s,e,n){let{r:t,n:i,k:u}=s,{deltaMeses:m}=e,p=i+m,x=p-u,C=Math.pow(1+t,x),P=n*(t*C)/(C-1),v=s.M0*(i-u),M=P*x-v;return{type:"Recalendario",newMonthlyPayment:P,newTerm:p,totalCostDelta:M,tirPost:t*12,tirOK:t*12<.35,warnings:m>12?["Extensi\xF3n mayor a 12 meses"]:[]}}simulateStepDown(s,e,n){let{r:t,n:i,k:u,M0:m}=s,{meses:p,alpha:x}=e,C=m*(1-x),P=m,v=n;for(let M=0;M<p;M++){let T=v*t,W=C-T;v=Math.max(0,v-W)}let E=i-u-p;if(E>0){let M=Math.pow(1+t,E),T=v*(t*M)/(M-1),W=m*(i-u),le=C*p+T*E-W;return{type:"Step-down",newMonthlyPayment:T,newTerm:i,totalCostDelta:le,tirPost:t*12,tirOK:t*12<.35,warnings:T>m*1.2?["Pago post-crisis alto"]:[]}}return{type:"Step-down",newMonthlyPayment:C,newTerm:i,totalCostDelta:0,tirPost:t*12,tirOK:!0,warnings:[]}}static \u0275fac=function(e){return new(e||c)};static \u0275prov=z({token:c,factory:c.\u0275fac,providedIn:"root"})};function de(c,s){if(c&1&&(o(0,"div",33),a(1),r()),c&2){let e=d().$implicit;l(),f(" \u26A0\uFE0F ",e.warnings.join(", ")," ")}}function pe(c,s){if(c&1){let e=O();o(0,"div",34)(1,"div")(2,"label",35),a(3),r(),o(4,"input",13),b("ngModelChange",function(t){g(e);let i=d(2);return h(i.diferimientoMeses,t)||(i.diferimientoMeses=t),_(t)}),w("ngModelChange",function(){g(e);let t=d(2);return _(t.runSimulation())}),r()(),o(5,"div",36)(6,"input",37),b("ngModelChange",function(t){g(e);let i=d(2);return h(i.diferimientoCapitaliza,t)||(i.diferimientoCapitaliza=t),_(t)}),w("ngModelChange",function(){g(e);let t=d(2);return _(t.runSimulation())}),r(),o(7,"label",38),a(8,"Capitalizar Intereses"),r()()()}if(c&2){let e=d(2);l(3),f(" Meses a Diferir: ",e.diferimientoMeses," "),l(),S("ngModel",e.diferimientoMeses),l(2),S("ngModel",e.diferimientoCapitaliza)}}function me(c,s){if(c&1){let e=O();o(0,"div",39)(1,"label",35),a(2),r(),o(3,"input",40),b("ngModelChange",function(t){g(e);let i=d(2);return h(i.recalendarioDeltaMeses,t)||(i.recalendarioDeltaMeses=t),_(t)}),w("ngModelChange",function(){g(e);let t=d(2);return _(t.runSimulation())}),r()()}if(c&2){let e=d(2);l(2),f(" Meses a Extender: ",e.recalendarioDeltaMeses," "),l(),S("ngModel",e.recalendarioDeltaMeses)}}function ue(c,s){if(c&1){let e=O();o(0,"div",34)(1,"div")(2,"label",35),a(3),r(),o(4,"input",13),b("ngModelChange",function(t){g(e);let i=d(2);return h(i.stepDownMeses,t)||(i.stepDownMeses=t),_(t)}),w("ngModelChange",function(){g(e);let t=d(2);return _(t.runSimulation())}),r()(),o(5,"div")(6,"label",35),a(7),r(),o(8,"input",41),b("ngModelChange",function(t){g(e);let i=d(2);return h(i.stepDownAlpha,t)||(i.stepDownAlpha=t),_(t)}),w("ngModelChange",function(){g(e);let t=d(2);return _(t.runSimulation())}),r()()()}if(c&2){let e=d(2);l(3),f(" Meses Reducidos: ",e.stepDownMeses," "),l(),S("ngModel",e.stepDownMeses),l(3),f(" Reducci\xF3n (%): ",e.stepDownAlpha*100,"% "),l(),S("ngModel",e.stepDownAlpha)}}function ge(c,s){if(c&1){let e=O();o(0,"div",23)(1,"h4",24),a(2),r(),o(3,"div",25)(4,"div",26)(5,"span",27),a(6,"Pago Mensual:"),r(),o(7,"strong",28),a(8),y(9,"currency"),r()(),o(10,"div",26)(11,"span",27),a(12,"Plazo Final:"),r(),o(13,"strong",28),a(14),r()(),o(15,"div",26)(16,"span",27),a(17,"Costo Total (\u0394):"),r(),o(18,"strong"),a(19),y(20,"currency"),r()(),o(21,"div",26)(22,"span",27),a(23,"TIR Post:"),r(),o(24,"span"),a(25),y(26,"percent"),r()(),V(27,de,2,1,"div",29),r(),V(28,pe,9,3,"div",30)(29,me,4,2,"div",31)(30,ue,9,4,"div",30),o(31,"button",32),w("click",function(){let t=g(e).$implicit,i=d();return _(i.applyProtection(t))}),a(32," Aplicar y Firmar Adendum "),r()()}if(c&2){let e=s.$implicit;l(2),R(e.type),l(6),R(D(9,17,e.newMonthlyPayment)),l(6),f("",e.newTerm," meses"),l(4),F("text-red-600",e.totalCostDelta>0)("text-green-600",e.totalCostDelta<0),l(),f(" ",D(20,19,e.totalCostDelta)," "),l(5),F("text-green-600",e.tirOK)("text-red-600",!e.tirOK),l(),f(" ",D(26,21,e.tirPost)," "),l(2),I("ngIf",e.warnings.length>0),l(),I("ngIf",e.type==="Diferimiento"),l(),I("ngIf",e.type==="Recalendario"),l(),I("ngIf",e.type==="Step-down")}}var ae=class c{constructor(s,e,n){this.route=s;this.router=e;this.protectionService=n}clientId=null;contratoBase={P0:2e5,r:.02,n:48,M0:5800,k:12,Bk:0};motivoRestructura="incapacidad";mesesAfectados=1;diferimientoMeses=1;diferimientoCapitaliza=!0;recalendarioDeltaMeses=6;stepDownMeses=1;stepDownAlpha=.25;simulatedScenarios=[];ngOnInit(){this.clientId=this.route.snapshot.paramMap.get("clientId"),this.runSimulation()}runSimulation(){let s={contrato:this.contratoBase,opciones:{diferimiento:{d:this.diferimientoMeses,capitalizaInteres:this.diferimientoCapitaliza},recalendario:{deltaMeses:this.recalendarioDeltaMeses},stepDown:{meses:this.stepDownMeses,alpha:this.stepDownAlpha},colectivo:{usarFondo:!0}}};this.protectionService.simulateProtection(s).subscribe(e=>{this.simulatedScenarios=e.escenarios})}applyProtection(s){if(!this.clientId){alert("Error: ID de cliente no encontrado.");return}this.protectionService.applyProtection(this.clientId,s).subscribe(e=>{alert(`Protecci\xF3n aplicada: ${e.message||e.status}`)})}static \u0275fac=function(e){return new(e||c)(B(J),B(Q),B(A))};static \u0275cmp=j({type:c,selectors:[["app-proteccion-simulator"]],decls:56,vars:17,consts:[[1,"proteccion-container","p-6","max-w-6xl","mx-auto"],[1,"bg-white","rounded-lg","shadow-lg","p-6"],[1,"text-2xl","font-bold","text-gray-800","mb-2"],[1,"text-gray-600","mb-6"],[1,"bg-red-50","rounded-lg","p-4","mb-6"],[1,"text-lg","font-semibold","text-red-800","mb-4"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"form-group"],[1,"block","text-sm","font-medium","text-gray-700","mb-2"],[1,"w-full","p-2","border","border-gray-300","rounded-md","focus:ring-2","focus:ring-red-500",3,"ngModelChange","ngModel"],["value","incapacidad"],["value","falla"],["value","ingresos"],["type","range","min","1","max","3",1,"w-full","h-2","bg-gray-200","rounded-lg","appearance-none","cursor-pointer",3,"ngModelChange","ngModel"],[1,"bg-blue-50","rounded-lg","p-4","mb-6"],[1,"text-lg","font-semibold","text-blue-800","mb-3"],[1,"grid","grid-cols-2","md:grid-cols-4","gap-4","text-sm"],[1,"text-blue-600"],[1,"font-bold","text-blue-800"],[1,"scenarios-panel"],[1,"text-lg","font-semibold","mb-4"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-6"],["class","scenario-card bg-gray-50 rounded-lg p-4 border border-gray-200",4,"ngFor","ngForOf"],[1,"scenario-card","bg-gray-50","rounded-lg","p-4","border","border-gray-200"],[1,"text-lg","font-semibold","text-gray-800","mb-3"],[1,"scenario-details","space-y-2","mb-4"],[1,"flex","justify-between"],[1,"text-gray-600"],[1,"text-gray-800"],["class","text-sm text-orange-600",4,"ngIf"],["class","variant-sliders space-y-3 mb-4",4,"ngIf"],["class","variant-sliders mb-4",4,"ngIf"],[1,"w-full","bg-blue-600","text-white","py-2","px-4","rounded-md","font-semibold","hover:bg-blue-700","transition-colors",3,"click"],[1,"text-sm","text-orange-600"],[1,"variant-sliders","space-y-3","mb-4"],[1,"block","text-sm","text-gray-600","mb-1"],[1,"flex","items-center"],["type","checkbox",1,"mr-2",3,"ngModelChange","ngModel"],[1,"text-sm","text-gray-600"],[1,"variant-sliders","mb-4"],["type","range","min","1","max","12",1,"w-full","h-2","bg-gray-200","rounded-lg","appearance-none","cursor-pointer",3,"ngModelChange","ngModel"],["type","range","min","0.1","max","0.5","step","0.05",1,"w-full","h-2","bg-gray-200","rounded-lg","appearance-none","cursor-pointer",3,"ngModelChange","ngModel"]],template:function(e,n){e&1&&(o(0,"div",0)(1,"div",1)(2,"h2",2),a(3,"\u{1F6E1}\uFE0F Protecci\xF3n Conductores"),r(),o(4,"p",3),a(5),r(),o(6,"div",4)(7,"h3",5),a(8,"Contexto de la Crisis"),r(),o(9,"div",6)(10,"div",7)(11,"label",8),a(12,"Motivo:"),r(),o(13,"select",9),b("ngModelChange",function(i){return h(n.motivoRestructura,i)||(n.motivoRestructura=i),i}),o(14,"option",10),a(15,"Incapacidad M\xE9dica"),r(),o(16,"option",11),a(17,"Falla Mec\xE1nica Mayor"),r(),o(18,"option",12),a(19,"Ca\xEDda de Ingresos"),r()()(),o(20,"div",7)(21,"label",8),a(22),r(),o(23,"input",13),b("ngModelChange",function(i){return h(n.mesesAfectados,i)||(n.mesesAfectados=i),i}),w("ngModelChange",function(){return n.runSimulation()}),r()()()(),o(24,"div",14)(25,"h3",15),a(26,"Informaci\xF3n del Contrato"),r(),o(27,"div",16)(28,"div")(29,"p",17),a(30,"Principal Original"),r(),o(31,"p",18),a(32),y(33,"currency"),r()(),o(34,"div")(35,"p",17),a(36,"Mensualidad Actual"),r(),o(37,"p",18),a(38),y(39,"currency"),r()(),o(40,"div")(41,"p",17),a(42,"Pagos Realizados"),r(),o(43,"p",18),a(44),r()(),o(45,"div")(46,"p",17),a(47,"Tasa Anual"),r(),o(48,"p",18),a(49),y(50,"number"),r()()()(),o(51,"div",19)(52,"h3",20),a(53,"Explora Opciones de Protecci\xF3n"),r(),o(54,"div",21),V(55,ge,33,23,"div",22),r()()()()),e&2&&(l(5),f("Simula opciones de restructura para el contrato de ",n.clientId||"este cliente","."),l(8),S("ngModel",n.motivoRestructura),l(9),f(" Meses Afectados: ",n.mesesAfectados," "),l(),S("ngModel",n.mesesAfectados),l(9),R(D(33,10,n.contratoBase.P0)),l(6),R(D(39,12,n.contratoBase.M0)),l(6),K("",n.contratoBase.k," / ",n.contratoBase.n),l(5),f("",N(50,14,n.contratoBase.r*12*100,"1.1-1"),"%"),l(6),I("ngForOf",n.simulatedScenarios))},dependencies:[H,L,Y,re,ie,oe,Z,te,X,ne,$,ee,U,q,G],styles:[".proteccion-container[_ngcontent-%COMP%]{min-height:100vh;background-color:#f8fafc}.scenario-card[_ngcontent-%COMP%]{transition:all .3s ease}.scenario-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 12px #0000001a}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:500}input[type=range][_ngcontent-%COMP%]{background:linear-gradient(to right,#3b82f6,#60a5fa)}input[type=range][_ngcontent-%COMP%]::-webkit-slider-thumb{appearance:none;height:16px;width:16px;border-radius:50%;background:#3b82f6;cursor:pointer;border:2px solid #ffffff;box-shadow:0 2px 4px #0003}input[type=range][_ngcontent-%COMP%]::-moz-range-thumb{height:16px;width:16px;border-radius:50%;background:#3b82f6;cursor:pointer;border:2px solid #ffffff;box-shadow:0 2px 4px #0003}button[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 4px 8px #0000001a}button[_ngcontent-%COMP%]:active{transform:translateY(0)}.variant-sliders[_ngcontent-%COMP%], .scenario-details[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #e5e7eb;border-radius:.5rem;padding:1rem}"]})};export{ae as ProteccionSimulatorComponent};
